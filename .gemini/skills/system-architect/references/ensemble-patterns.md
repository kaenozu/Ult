# Ensemble Design Patterns

## Regime-Aware Ensemble (相場適応型統合)

このパターンは、市場の「文脈」に応じて最適な武器（指標）を持ち替えるための設計です。

### 1. 判定層 (Context Detection)
まず、市場が以下のどの状態にあるかを、ボラティリティと価格変化から特定します。
- `BULL`: 上昇トレンド
- `CRASH`: 暴落/パニック
- `RANGING`: ボックス圏
- `VOLATILE`: 乱高下

### 2. 評価層 (Dynamic Weighting)
判定された Regime に基づき、各モデルの重みをバイアス調整します。

| Regime | 最優先されるコンポーネント | 抑制されるコンポーネント |
| :--- | :--- | :--- |
| **CRASH** | 需給の壁 (Supply/Demand), ボラティリティ | AI予測 (トレンド追随型), テクニカル(逆張り) |
| **BULL** | AI予測, モメンタム | なし |
| **RANGING** | オシレーター系テクニカル (RSI, Stochastics) | 相関関係 |

### 3. 合計層 (Normalized Weighted Average)
すべてのスコアを重み付け合計し、最終的な確信度 (Confidence Score) を算出します。

## 実装上の注意
- **オーバーフィッティングの回避**: 重みの変化には「慣性（Learning Rate）」を持たせ、一時的なノイズで戦略が激変するのを防ぐ。
- **期待値（EV）フィルタ**: 最終的な確信度が高くても、手数料やスリッページを考慮した期待値がマイナスの場合は、確信度にペナルティを課す。
