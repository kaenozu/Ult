# AI予測精度改善設計書

## 目標

- **勝率:** 65%以上
- **期待値:** +2%以上
- **信頼性:** ユーザーが「AIの言う通りにしたらイケる」と実感できるレベル

## 現状

| 指標 | 現状値 | 目標値 |
|------|--------|--------|
| 勝率 | 21.8% | 65%+ |
| 期待値 | -15.89% | +2%+ |
| シグナル数 | 856 | 品質重視 |

## アプローチ

**複合型（段階実装）を採用:**
- Phase 1: トレンド重視戦略（テクニカル改良）
- Phase 2: ML統合
- Phase 3: 統合最適化

---

## Phase 1: トレンド重視戦略

### 目的
トレンドに乗ることで勝率を55-60%に引き上げる

### 実装内容

#### 1.1 MarketRegimeDetector活用
- 上昇トレンド（TRENDING_UP）判定を厳格化
- ADX > 30 + PlusDI > MinusDI = 強い上昇トレンド
- ADX > 30 + MinusDI > PlusDI = 強い下降トレンド

#### 1.2 BUY条件（全て満たす必要あり）
```
1. regime.type === 'TRENDING_UP'
2. RSI 40-60（中立圏）
3. 価格 > SMA(20)
4. confidence >= 70%
```

#### 1.3 SELL条件（全て満たす必要あり）
```
1. regime.type === 'TRENDING_DOWN'
2. RSI 40-60（中立圏）
3. 価格 < SMA(20)
4. confidence >= 70%
```

#### 1.4 レンジ相場除外
- `RANGING` または `VOLATILE` 時はシグナル発行しない
- 不確実性が高いため

#### 1.5 確信度閾値引き上げ
- 70%以上のみ表示
- 低確信シグナルはノイズとして除外

### 変更ファイル

| ファイル | 変更内容 |
|----------|----------|
| `ConsensusSignalService.ts` | トレンド判定ロジック追加 |
| `useAIRecommendations.ts` | レンジ除外・確信度フィルタ |
| `backtest-service.ts` | 新条件でバックテスト |
| `AIRecommendationPanel.tsx` | シグナル減少時のUI対応 |

### 期待効果

| 指標 | 改善前 | 改善後（予測） |
|------|--------|----------------|
| 勝率 | 21.8% | 55-60% |
| 期待値 | -15.89% | +0.5-1% |
| シグナル数 | 856 | 100-200（品質重視） |

---

## Phase 2: ML統合

### 目的
MLで予測精度をさらに向上させる

### 実装内容

#### 2.1 過去データ学習
- 過去2年のOHLCVデータを使用
- 特徴量: RSI, MACD, ボリューム, 価格変動率, SMA乖離

#### 2.2 モデル構成
- **Random Forest:** アンサンブルの基盤
- **XGBoost:** 勾配ブースティング
- **LSTM:** 時系列パターン学習（オプション）

#### 2.3 アンサンブル
- AdaptiveWeightCalculatorで動的重み調整
- トレンド時: XGBoost重視
- レンジ時: Random Forest重視

#### 2.4 一致条件
- ML予測とテクニカル予測が一致時のみシグナル発行
- 不一致時はHOLD

### 変更ファイル

| ファイル | 変更内容 |
|----------|----------|
| `ml-model-service.ts` | 実学習ロジック追加 |
| `useAIRecommendations.ts` | ML統合 |
| `backtest-service.ts` | ML評価追加 |

### 期待効果

| 指標 | Phase 1後 | Phase 2後（予測） |
|------|-----------|-------------------|
| 勝率 | 55-60% | 60-65% |
| 期待値 | +0.5-1% | +1-2% |

---

## Phase 3: 統合最適化

### 目的
プロ級（65%勝率、+2%期待値）達成

### 実装内容

#### 3.1 フィードバックループ
- 過去シグナルの的中率を記録
- 銘柄別・確信度別の勝率を学習
- 信頼性の高い銘柄を優先推奨

#### 3.2 動的パラメータ調整
- 市場ボラティリティに応じて閾値変更
- 高ボラティリティ時: 確信度閾値上げ
- 低ボラティリティ時: 確信度閾値下げ

#### 3.3 リスク管理最適化
- ATRベースの動的ストップロス
- 銘柄別ボラティリティ考慮
- テイクプロフィット/ストップロス比率最適化

#### 3.4 信頼度表示改善
- 過去実績ベースの信頼度スコア
- 「過去10シグナル中8勝（80%）」など表示
- 確信度別の期待リターン表示

### 変更ファイル

| ファイル | 変更内容 |
|----------|----------|
| `result-analyzer.ts` | 的中率学習追加 |
| `signalHistoryStore.ts` | 統計データ蓄積 |
| `AIRecommendationPanel.tsx` | 信頼度表示改善 |
| `backtest-service.ts` | 動的パラメータ対応 |

### 期待効果

| 指標 | Phase 2後 | Phase 3後（目標） |
|------|-----------|-------------------|
| 勝率 | 60-65% | **65%+** |
| 期待値 | +1-2% | **+2%+** |

---

## テスト計画

### 各フェーズ完了時
1. バックテスト実行（最低100銘柄）
2. 勝率・期待値確認
3. 目標未達成時はパラメータ調整

### 最終検証
1. 3ヶ月期間のバックテスト
2. ウォークフォワード分析
3. 過去データでシグナル発行→結果検証

---

## リスク

| リスク | 対策 |
|--------|------|
| シグナル数激減 | 確信度閾値を動的に調整 |
| 過学習 | ウォークフォワード検証 |
| データ不足 | 最低2年分のデータ確保 |
| 計算コスト | ML推論は非同期実行 |

---

## スケジュール

| Phase | 期間 | 内容 |
|-------|------|------|
| Phase 1 | 1-2時間 | トレンド重視戦略実装 |
| Phase 2 | 2-4時間 | ML統合 |
| Phase 3 | 2-3時間 | 統合最適化 |
| テスト | 1時間 | 最終検証 |

**合計:** 6-10時間
