# 期待リターン最大化システム設計

## ゴール

**「AIの推奨銘柄を買うと、その時点での最善の期待リターンが得られる」**

- 絶対勝利ではなく、常に最善の選択肢を提示
- スイングトレード（数日〜数週間）に最適化
- 継続的な改善サイクルを構築

## 成功基準

- 高確信シグナル（>70%）の期待リターン > 0
- 継続的な精度改善（フィードバックループ）
- ユーザーが「どこを見て判断すればいいか」一目で分かる

## アーキテクチャ

```
┌─────────────────────────────────────────────────────────────┐
│                    Signal Quality Engine                     │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────┐ │
│  │ Market Regime   │  │ Adaptive        │  │ Confidence  │ │
│  │ Detection       │──▶│ Ensemble        │──▶│ Scorer      │ │
│  │ (トレンド判定)   │  │ (動的重み)      │  │ (確信度)    │ │
│  └─────────────────┘  └─────────────────┘  └─────────────┘ │
└────────────────────────────┬────────────────────────────────┘
                             │ シグナル
                             ▼
┌─────────────────────────────────────────────────────────────┐
│                    Feedback Loop System                      │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────┐ │
│  │ Signal Tracker  │  │ Result Analyzer │  │ Model Tuner │ │
│  │ (結果記録)      │──▶│ (精度分析)      │──▶│ (改善提案) │ │
│  └─────────────────┘  └─────────────────┘  └─────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

## Signal Quality Engine

### Market Regime Detection

市場状況を4つに分類：

| レジーム | 特徴 | 推奨モデル重み |
|---------|------|---------------|
| TRENDING_UP | 上昇トレンド | XGB重視 |
| TRENDING_DOWN | 下降トレンド | RF重視 |
| RANGING | レンジ相場 | LSTM軽視 |
| VOLATILE | 高ボラティリティ | LSTM重視 |

**判定方法**: ADX（トレンド強度）+ ATR比率（ボラティリティ）

### Adaptive Ensemble

現在: 固定重み RF=0.35, XGB=0.35, LSTM=0.30
改善: 動的重み → 状況に最適化

### Confidence Scorer

シグナルの「確信度」を計算：

- **高確信（>70%）**: 積極的に推奨
- **中確信（50-70%）**: 通常のシグナル
- **低確信（<50%）**: 推奨しない（HOLD）

## Feedback Loop System

### Signal Tracker

シグナルを記録し、後で結果を評価：

```typescript
interface TrackedSignal {
  symbol: string;
  type: 'BUY' | 'SELL' | 'HOLD';
  confidence: number;
  expectedReturn: number;
  generatedAt: string;
  actualReturn?: number;
  result?: 'HIT' | 'MISS';
  evaluatedAt?: string;
}
```

### Result Analyzer

分析軸：
- 全体の勝率・期待リターン
- 銘柄別の精度
- 市場レジーム別の精度
- 確信度別の精度

### Model Tuner

改善の例：
- 「LSTMは高ボラ時のみ有効 → 重み調整」
- 「確信度60%以下は勝率30% → 推奨しない閾値を上げる」

## UI導線設計

### 新しいレイアウト

```
┌─────────────────────────────────────────────────────────────────────┐
│  HEADER: TRADER PRO | 資産状況 | 通知                               │
├───────────────┬─────────────────────────────────────┬───────────────┤
│               │  🌟 AI推奨（最上位）                 │               │
│  ウォッチ     │  ┌─────┐ ┌─────┐ ┌─────┐           │  分析パネル   │
│  リスト       │  │ BUY │ │ BUY │ │HOLD │           │  ├ シグナル   │
│               │  │ 85% │ │ 72% │ │ 45% │           │  ├ 予測       │
│               │  └─────┘ └─────┘ └─────┘           │  ├ 戦績       │
│               ├─────────────────────────────────────┤               │
│               │  📈 チャート                         │               │
│               │  （ローソク足 + RSI + ボリューム）    │               │
│               ├─────────────────────────────────────┤               │
│               │  📋 シグナル履歴                     │               │
│               │  （過去の推奨と結果）                 │               │
└───────────────┴─────────────────────────────────────┴───────────────┘
```

### 情報の優先度

| 優先度 | 内容 | 配置 |
|-------|------|------|
| **最高** | AI推奨銘柄（高確信） | チャート直上 |
| **高** | 現在銘柄のシグナル | 右サイドバー上部 |
| **中** | チャート・テクニカル | 中央 |
| **低** | ウォッチリスト | 左サイドバー |

### アクション導線

「推奨 → 確認 → 購入」を3クリック以内に：

1. AI推奨パネルで「BUY 85%」をクリック
2. シグナル詳細・期待リターン確認
3. 「注文」ボタン

## ページ構成

### 最終構成

```
/                → メイン（チャート + AI推奨パネル）
/recommendations → AI推奨銘柄一覧（新規）
/screener        → 銘柄スクリーニング
/universe        → 投資対象一覧
/heatmap         → 市場ヒートマップ
/analysis        → AI詳細分析
/ai-advisor      → AI相談
/portfolio       → ポートフォリオ（統合版）
```

### 削除

- `/behavioral-demo` - デモ用、本番不要
- `/api-docs` - 開発者向け、ユーザーには不要
- `/prediction-clouds` - メインチャートに統合可能

### 統合

- `/portfolio-analysis` → `/portfolio`
- `/performance` → `/portfolio`
- `/journal` → `/` の履歴パネル

## 変更ファイル一覧

### 新規作成

| ファイル | 内容 |
|---------|------|
| `components/AIRecommendationPanel.tsx` | AI推奨銘標パネル |
| `app/recommendations/page.tsx` | AI推奨銘柄一覧ページ |
| `services/market-regime-detector.ts` | 市場レジーム検出 |
| `services/confidence-scorer.ts` | 確信度スコア計算 |
| `services/result-analyzer.ts` | シグナル結果分析 |
| `services/model-tuner.ts` | モデル改善提案 |

### 修正

| ファイル | 変更内容 |
|---------|---------|
| `services/implementations/prediction-calculator.ts` | 動的重み対応 |
| `components/SignalHistoryPanel.tsx` | 結果評価機能追加 |
| `page.tsx` | AI推奨パネル追加 |
| `store/signalHistoryStore.ts` | 結果評価ロジック追加 |

### 削除

| ファイル/ディレクトリ | 理由 |
|---------------------|------|
| `app/behavioral-demo/` | デモ用 |
| `app/api-docs/` | 開発者用 |
| `app/prediction-clouds/` | 統合済み |

## 制約

- フロントエンド完結（外部サーバー不要）
- 無料APIのみ使用
- シンプルなUX（初心者でも理解可能）

---

作成日: 2026-02-18
ステータス: 承認済み
