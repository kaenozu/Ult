<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WebXR Galaxy</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.3.3/dist/aframe-environment-component.min.js"></script>
    <script src="https://unpkg.com/aframe-extras@7.1.0/dist/aframe-extras.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        overflow: hidden;
      }

      .warning-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.95);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        opacity: 1;
        transition: opacity 0.5s ease;
      }

      .warning-overlay.hidden {
        opacity: 0;
        pointer-events: none;
      }

      .warning-content {
        text-align: center;
        color: white;
        max-width: 600px;
        padding: 40px;
        border: 2px solid #4a9eff;
        border-radius: 15px;
        background: linear-gradient(
          135deg,
          rgba(74, 158, 255, 0.1),
          rgba(128, 0, 128, 0.1)
        );
      }

      .warning-content h1 {
        font-size: 2.5em;
        margin-bottom: 20px;
        background: linear-gradient(135deg, #4a9eff, #ff6b9d);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .warning-content p {
        font-size: 1.1em;
        line-height: 1.8;
        margin-bottom: 15px;
        color: #ccc;
      }

      .warning-icon {
        font-size: 4em;
        margin-bottom: 20px;
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
      }

      .enter-btn {
        background: linear-gradient(135deg, #4a9eff, #ff6b9d);
        border: none;
        padding: 15px 50px;
        font-size: 1.2em;
        color: white;
        border-radius: 30px;
        cursor: pointer;
        margin-top: 20px;
        transition:
          transform 0.3s ease,
          box-shadow 0.3s ease;
      }

      .enter-btn:hover {
        transform: scale(1.05);
        box-shadow: 0 10px 30px rgba(74, 158, 255, 0.4);
      }

      .controls-info {
        margin-top: 30px;
        padding: 20px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        text-align: left;
      }

      .controls-info h3 {
        color: #4a9eff;
        margin-bottom: 10px;
      }

      .controls-info ul {
        list-style: none;
      }

      .controls-info li {
        padding: 5px 0;
        color: #aaa;
      }

      .controls-info li::before {
        content: "‚Üí ";
        color: #ff6b9d;
      }
    </style>
  </head>
  <body>
    <div class="warning-overlay" id="warningOverlay">
      <div class="warning-content">
        <div class="warning-icon">üåå</div>
        <h1>WebXR Galaxy</h1>
        <p>
          <strong>‚ö†Ô∏è Motion Sickness Warning</strong><br />
          This experience contains moving visuals that may cause motion sickness
          in some users.
        </p>
        <p>
          Please take breaks if you feel discomfort. If you have a history of
          motion sickness, please consult a doctor before using VR.
        </p>
        <div class="controls-info">
          <h3>Controls</h3>
          <ul>
            <li><strong>VR:</strong> Use controller thumbstick to teleport</li>
            <li><strong>Desktop:</strong> Click and drag to look around</li>
            <li><strong>Movement:</strong> WASD keys + mouse to move</li>
          </ul>
        </div>
        <button class="enter-btn" onclick="enterExperience()">
          Enter Galaxy
        </button>
      </div>
    </div>

    <a-scene
      vr-mode-ui="enabled: true"
      renderer="antialias: true; colorManagement: true; sortObjects: true"
      fog="type: exponential; color: #0a0a1a; density: 0.0008"
      background="color: #0a0a1a"
    >
      <a-assets>
        <img
          id="nebula-texture"
          src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100'%3E%3Cdefs%3E%3CradialGradient id='g'%3E%3Cstop offset='0%25' stop-color='%23663399'/%3E%3Cstop offset='100%25' stop-color='%230a0a1a'/%3E%3C/radialGradient%3E%3C/defs%3E%3Crect fill='%230a0a1a' width='100' height='100'/%3E%3Cellipse cx='50' cy='50' rx='45' ry='45' fill='url(%23g)' opacity='0.6'/%3E%3C/svg%3E"
        />
      </a-assets>

      <a-entity id="galaxy" galaxy-generator></a-entity>

      <a-entity id="stars" star-field></a-entity>

      <a-entity id="nebulae">
        <a-sphere
          position="0 0 -500"
          radius="300"
          material="color: #663399; opacity: 0.1; transparent: true; shader: flat"
          animation="property: rotation; to: 0 360 0; dur: 120000; loop: true; easing: linear"
        ></a-sphere>
        <a-sphere
          position="400 200 -300"
          radius="200"
          material="color: #ff6b9d; opacity: 0.08; transparent: true; shader: flat"
          animation="property: rotation; to: 360 0 0; dur: 150000; loop: true; easing: linear"
        ></a-sphere>
        <a-sphere
          position="-300 -100 -400"
          radius="250"
          material="color: #4a9eff; opacity: 0.08; transparent: true; shader: flat"
          animation="property: rotation; to: 0 0 360; dur: 180000; loop: true; easing: linear"
        ></a-sphere>
      </a-entity>

      <a-entity
        id="teleport-system"
        teleport-controls="cameraRig: #cameraRig; teleportOrigin: #camera; collisionEntities: .teleportable; button: trigger; curveShootingSpeed: 10; hitCylinderColor: #4a9eff; hitCylinderRadius: 0.3"
      ></a-entity>

      <a-entity id="cameraRig" position="0 0 0">
        <a-entity
          id="camera"
          camera
          look-controls="pointerLockEnabled: false"
          wasd-controls="acceleration: 30; fly: false"
          position="0 1.6 0"
        >
          <a-entity id="hud" fixed-hud position="0 0 -1">
            <a-entity position="0 0.35 0">
              <a-text
                value="WebXR Galaxy"
                align="center"
                color="#4a9eff"
                width="1.5"
                font="mozillavr"
                position="0 0.08 0"
              >
              </a-text>
              <a-text
                id="position-display"
                value="Position: 0, 0, 0"
                align="center"
                color="#ff6b9d"
                width="1"
                position="0 -0.02 0"
              >
              </a-text>
            </a-entity>

            <a-entity position="-0.5 -0.3 0">
              <a-plane
                width="0.25"
                height="0.08"
                color="#1a1a2e"
                opacity="0.9"
              ></a-plane>
              <a-text
                value="[Trigger] Teleport"
                align="center"
                color="#4a9eff"
                width="0.8"
                position="0 0 0.01"
              >
              </a-text>
            </a-entity>

            <a-entity position="0.5 -0.3 0">
              <a-plane
                width="0.25"
                height="0.08"
                color="#1a1a2e"
                opacity="0.9"
              ></a-plane>
              <a-text
                value="[WASD] Move"
                align="center"
                color="#4a9eff"
                width="0.8"
                position="0 0 0.01"
              >
              </a-text>
            </a-entity>
          </a-entity>
        </a-entity>

        <a-entity
          id="leftHand"
          laser-controls="hand: left"
          raycaster="objects: .teleportable; far: 30"
          line="color: #4a9eff; opacity: 0.75"
        >
        </a-entity>

        <a-entity
          id="rightHand"
          laser-controls="hand: right"
          raycaster="objects: .teleportable; far: 30"
          line="color: #ff6b9d; opacity: 0.75"
        >
        </a-entity>
      </a-entity>

      <a-entity id="teleport-platforms">
        <a-cylinder
          class="teleportable"
          position="0 -0.5 0"
          radius="2"
          height="0.1"
          material="color: #1a1a2e; opacity: 0.9"
        ></a-cylinder>
        <a-cylinder
          class="teleportable"
          position="50 0 0"
          radius="2"
          height="0.1"
          material="color: #1a1a2e; opacity: 0.9"
        ></a-cylinder>
        <a-cylinder
          class="teleportable"
          position="-50 0 0"
          radius="2"
          height="0.1"
          material="color: #1a1a2e; opacity: 0.9"
        ></a-cylinder>
        <a-cylinder
          class="teleportable"
          position="0 0 50"
          radius="2"
          height="0.1"
          material="color: #1a1a2e; opacity: 0.9"
        ></a-cylinder>
        <a-cylinder
          class="teleportable"
          position="0 0 -50"
          radius="2"
          height="0.1"
          material="color: #1a1a2e; opacity: 0.9"
        ></a-cylinder>
        <a-cylinder
          class="teleportable"
          position="30 20 -80"
          radius="2"
          height="0.1"
          material="color: #1a1a2e; opacity: 0.9"
        ></a-cylinder>
        <a-cylinder
          class="teleportable"
          position="-40 10 40"
          radius="2"
          height="0.1"
          material="color: #1a1a2e; opacity: 0.9"
        ></a-cylinder>
        <a-cylinder
          class="teleportable"
          position="0 -10 100"
          radius="2"
          height="0.1"
          material="color: #1a1a2e; opacity: 0.9"
        ></a-cylinder>
        <a-cylinder
          class="teleportable"
          position="-30 -5 -60"
          radius="2"
          height="0.1"
          material="color: #1a1a2e; opacity: 0.9"
        ></a-cylinder>
      </a-entity>

      <a-entity
        id="ambient-light"
        light="type: ambient; color: #222233; intensity: 0.3"
      ></a-entity>

      <a-light
        type="directional"
        color="#4a9eff"
        intensity="0.2"
        position="1 1 0"
      ></a-light>
      <a-light
        type="directional"
        color="#ff6b9d"
        intensity="0.1"
        position="-1 0 1"
      ></a-light>
    </a-scene>

    <script>
      AFRAME.registerComponent("galaxy-generator", {
        init: function () {
          const galaxy = this.el;
          const armCount = 5;
          const armLength = 400;
          const starsPerArm = 800;

          for (let arm = 0; arm < armCount; arm++) {
            const armAngle = (arm / armCount) * Math.PI * 2;

            for (let i = 0; i < starsPerArm; i++) {
              const distance = (i / starsPerArm) * armLength;
              const spread = distance * 0.15 + Math.random() * 30;
              const angleOffset =
                armAngle +
                (distance / armLength) * 3 +
                (Math.random() - 0.5) * 0.5;

              const x =
                Math.cos(angleOffset) * distance +
                (Math.random() - 0.5) * spread;
              const y = (Math.random() - 0.5) * spread * 0.4;
              const z =
                Math.sin(angleOffset) * distance +
                (Math.random() - 0.5) * spread;

              const star = document.createElement("a-sphere");
              const size = Math.random() * 2 + 0.5;
              star.setAttribute("radius", size * 0.15);

              const colors = [
                "#ffffff",
                "#fffae0",
                "#ffe4b5",
                "#b0e0e6",
                "#ffb6c1",
                "#add8e6",
              ];
              const color = colors[Math.floor(Math.random() * colors.length)];
              star.setAttribute(
                "material",
                `color: ${color}; emissive: ${color}; emissiveIntensity: ${Math.random() * 0.5 + 0.3}`,
              );

              star.setAttribute("position", `${x} ${y} ${z}`);
              star.setAttribute(
                "animation",
                `property: material.emissiveIntensity; from: ${Math.random() * 0.3 + 0.3}; to: ${Math.random() * 0.3 + 0.6}; dur: ${Math.random() * 2000 + 1000}; loop: true; dir: alternate; easing: easeInOutSine`,
              );

              galaxy.appendChild(star);
            }
          }
        },
      });

      AFRAME.registerComponent("star-field", {
        init: function () {
          const starCount = 3000;

          for (let i = 0; i < starCount; i++) {
            const star = document.createElement("a-sphere");
            const distance = 600 + Math.random() * 400;
            const theta = Math.random() * Math.PI * 2;
            const phi = Math.acos(2 * Math.random() - 1);

            const x = distance * Math.sin(phi) * Math.cos(theta);
            const y = distance * Math.sin(phi) * Math.sin(theta);
            const z = distance * Math.cos(phi);

            star.setAttribute("radius", Math.random() * 0.8 + 0.3);
            const brightness = Math.random() * 0.5 + 0.5;
            star.setAttribute(
              "material",
              `color: #ffffff; emissive: #ffffff; emissiveIntensity: ${brightness}`,
            );

            star.setAttribute("position", `${x} ${y} ${z}`);
            this.el.appendChild(star);
          }
        },
      });

      AFRAME.registerComponent("fixed-hud", {
        init: function () {
          this.camera = document.querySelector("#camera");
          this.positionDisplay = document.querySelector("#position-display");
        },
        tick: function () {
          if (this.camera && this.positionDisplay) {
            const pos = this.camera.getAttribute("position");
            const x = pos.x.toFixed(1);
            const y = pos.y.toFixed(1);
            const z = pos.z.toFixed(1);
            this.positionDisplay.setAttribute(
              "value",
              `Position: ${x}, ${y}, ${z}`,
            );
          }
        },
      });

      function enterExperience() {
        const overlay = document.getElementById("warningOverlay");
        overlay.classList.add("hidden");
        setTimeout(() => {
          overlay.style.display = "none";
        }, 500);
      }

      document.addEventListener("DOMContentLoaded", () => {
        console.log("WebXR Galaxy loaded successfully");
        console.log(
          "Controls: WASD to move, Mouse to look, VR controller trigger to teleport",
        );
      });
    </script>
  </body>
</html>
