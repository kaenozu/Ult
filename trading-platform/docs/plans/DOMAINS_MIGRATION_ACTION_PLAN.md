# Domains Migration Action Plan

## 背景

`lib/`ディレクトリと`domains/`ディレクトリが混在しており、コードの一貫性と保守性を向上させるために、`lib/`内の機能を`domains/`に整理して移行します。

## 現在状況

### 既存のディレクトリ構造
```
trading-platform/
├── app/
│   ├── lib/
│   │   ├── aiAnalytics/
│   │   ├── backtest/
│   │   ├── domains/
│   │   │   ├── backtest/engine/
│   │   │   ├── prediction/
│   │   │   └── ...
│   │   ├── execution/
│   │   ├── risk/
│   │   ├── sentiment/
│   │   └── tradingCore/
│   └── components/
```

### 問題点
1. **重複**: `lib/backtest/`と`domains/backtest/engine/`に重複がある
2. **混在**: `lib/`と`domains/`の境界が不明確
3. **統一性**: 同じ機能が別の場所で実装されている可能性がある
4. **メンテナンス**: コードの所在場所が明確でない

## 移行計画

### Phase 1: インベントリ（Week 1）

#### 1.1 現状の詳細な調査
**担当**: - 
**期間**: 2日

**タスク**:
- [ ] 各ドメインの機能をマッピング
- [ ] 重複コードの特定
- [ ] 依存関係の分析
- [ ] 推奨移行順序の決定

**出力**: ドメイン・機能マップ

#### 1.2 移行戦略の策定
**担当**: -
**期間**: 1日

**タスク**:
- [ ] 既存コードの削除・移行の方針決定（新規作成 vs 移行）
- [ ] テストカバレッジ維持策の策定
- [ ] E2Eテストの移行先決定

**出力**: 移行戦略ドキュメント

#### 1.3 ステークホルダー作成
**担当**: -
**期間**: 3日

**タスク**:
- [ ] 新しいフォルダ構造の策定
- [ ] 空フォルダの作成
- [ ] 移行スクリプトの作成

**出力**: 空フォルダとスクリプト

### Phase 2: 実行（Week 2-3）

#### 2.1 Core Domainsの移行
**期間**: 5日

**優先順序**:
1. **Prediction Domain** (影響度: 高)
2. **Backtest Domain** (影響度: 高)
3. **Execution Domain** (影響度: 中)
4. Risk Management Domain** (影響度: 高)
5. **Sentiment Analysis Domain** (影響度: 中)
6. **Data Feed Domain** (影響度: 中)

**タスク**:
- [ ] Prediction Domainを`domains/prediction/`に移行
- [ ] Backtest Engineを統合して`domains/backtest/`に移行
- [ ] Execution関連を統合して`domains/execution/`に移行
- [ ] Risk Managerを統合して`domains/risk/`に移行
- [ ] Sentiment Analysisを統合して`domains/sentiment/`に移行
- [ ] Data Feedを統合して`domains/data-feed/`に移行

**成功基準**:
- 全てのテストが通る
- 既存のコードから参照が更新されている
- E2Eテストが移行されている

#### 2.2 Integration & Cleanup
**期間**: 5日

**タスク**:
- [ ] `lib/`内の重複コードを削除
- [ ] 移行元のファイルを削除（参照が更新された後）
- [ ] インポートパスの一括更新
- [ ] READMEとROADMAPの更新

#### 2.3 検証
**期間**: 2日

**タスク**:
- [ ] ユニットテスト全通
- [ ] E2Eテスト全通
- [ ] ローカルでのテスト実行
- [ ] パフォーマンス要件の確認

### Phase 3: ドキュメント化（Week 4）

**タスク**:
- [ ] ドメインアーキテクチャ作成
- [ ] API仕様書更新
- [ ] 移行ガイドライン作成
- [ ] チュートリアル追加

## リスク管理

### 技術的リスク
- **破壊的変更**: メジャーリファクタで段階的に進める
- **データ損失**: 移行中のデータ損失を防ぐ
- **パフォーマンス**: コード規約に従う

### 軻和策
- 既存コードとの互換性を維持する
- 期間中で一部だけでも成果を出す

## 成功指標（KPI）

| メトリクス | 現状 | 目標 |
|---------|--------|------|
| 移行率 | 0% | 100% |
| テスト成功率 | N/A | 100% |
| コード品質スコア | N/A | 8/10以上 |

## 注意事項

1. 一度に全てを移行しない
2. 各フェーズの完了を確認してから次へ進める
3. 予期せぬ事態に柔軟に対応する
4. 定期的に進捗をチームで共有する

## 次のステップ

1. このアクションプランを承認
2. Phase 1のタスクを開始
3. 週次進捗を更新
