npm warn Expanding --ci to --cidr. This will stop working in the next major version of npm.

> trading-platform@0.1.0 test
> jest app/infrastructure/api/__tests__/DataAggregator.test.ts

  console.warn
    [2026-02-14T13:59:03.854Z] [WARN]  [Aggregator] Failed to update data for AAPL, using stale data.

    [0m [90m 84 |[39m     [36mconst[39m formatted [33m=[39m [36mthis[39m[33m.[39mformatMessage([32m'warn'[39m[33m,[39m message[33m,[39m context)[33m;[39m
     [90m 85 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39menableConsole) {
    [31m[1m>[22m[39m[90m 86 |[39m       console[33m.[39mwarn(formatted[33m,[39m data [33m?[39m[33m?[39m [32m''[39m)[33m;[39m
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 87 |[39m     }
     [90m 88 |[39m     [36mthis[39m[33m.[39maddLog({ timestamp[33m:[39m [36mnew[39m [33mDate[39m()[33m,[39m level[33m:[39m [32m'warn'[39m[33m,[39m message[33m,[39m context[33m,[39m data })[33m;[39m
     [90m 89 |[39m   }[0m

      at Logger.warn (app/core/logger.ts:86:15)
      at warn (app/infrastructure/api/data-aggregator.ts:241:24)

  console.warn
    [2026-02-14T13:59:07.432Z] [WARN]  [Aggregator] Failed to update data for AAPL, using stale data.

    [0m [90m 84 |[39m     [36mconst[39m formatted [33m=[39m [36mthis[39m[33m.[39mformatMessage([32m'warn'[39m[33m,[39m message[33m,[39m context)[33m;[39m
     [90m 85 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39menableConsole) {
    [31m[1m>[22m[39m[90m 86 |[39m       console[33m.[39mwarn(formatted[33m,[39m data [33m?[39m[33m?[39m [32m''[39m)[33m;[39m
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 87 |[39m     }
     [90m 88 |[39m     [36mthis[39m[33m.[39maddLog({ timestamp[33m:[39m [36mnew[39m [33mDate[39m()[33m,[39m level[33m:[39m [32m'warn'[39m[33m,[39m message[33m,[39m context[33m,[39m data })[33m;[39m
     [90m 89 |[39m   }[0m

      at Logger.warn (app/core/logger.ts:86:15)
      at warn (app/infrastructure/api/data-aggregator.ts:241:24)
      at MarketDataClient.fetchOHLCV (app/infrastructure/api/data-aggregator.ts:265:20)
      at MarketDataClient.fetchData (app/infrastructure/api/data-aggregator.ts:503:20)
      at Object.<anonymous> (app/infrastructure/api/__tests__/DataAggregator.test.ts:139:7)

  console.warn
    [2026-02-14T13:59:10.969Z] [WARN]  [Aggregator] Failed to update data for AAPL, using stale data.

    [0m [90m 84 |[39m     [36mconst[39m formatted [33m=[39m [36mthis[39m[33m.[39mformatMessage([32m'warn'[39m[33m,[39m message[33m,[39m context)[33m;[39m
     [90m 85 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39menableConsole) {
    [31m[1m>[22m[39m[90m 86 |[39m       console[33m.[39mwarn(formatted[33m,[39m data [33m?[39m[33m?[39m [32m''[39m)[33m;[39m
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 87 |[39m     }
     [90m 88 |[39m     [36mthis[39m[33m.[39maddLog({ timestamp[33m:[39m [36mnew[39m [33mDate[39m()[33m,[39m level[33m:[39m [32m'warn'[39m[33m,[39m message[33m,[39m context[33m,[39m data })[33m;[39m
     [90m 89 |[39m   }[0m

      at Logger.warn (app/core/logger.ts:86:15)
      at warn (app/infrastructure/api/data-aggregator.ts:241:24)
      at MarketDataClient.fetchOHLCV (app/infrastructure/api/data-aggregator.ts:265:20)
      at MarketDataClient.fetchData (app/infrastructure/api/data-aggregator.ts:503:20)
      at Object.<anonymous> (app/infrastructure/api/__tests__/DataAggregator.test.ts:149:7)

FAIL app/infrastructure/api/__tests__/DataAggregator.test.ts (11.454 s)
  Utils Test Utils Dummy
    âˆš should pass (2 ms)
  DataAggregator
    ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½
      âˆš ãƒ‡ãƒ¼ã‚¿ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜ã—ã¦å–å¾—ã§ãã‚‹ (1 ms)
      âˆš TTLãŒåˆ‡ã‚ŒãŸã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯nullã‚’è¿”ã™ (18 ms)
      âˆš ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ã§ãã‚‹ (1 ms)
    ãƒãƒƒãƒå‡¦ç†
      âˆš è¤‡æ•°ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒãƒƒãƒã§å‡¦ç†ã§ãã‚‹ (8 ms)
      Ã— ãƒãƒƒãƒã‚µã‚¤ã‚ºåˆ¶é™ã‚’å°Šé‡ã™ã‚‹ (1 ms)
    ãƒªã‚¯ã‚¨ã‚¹ãƒˆé‡è¤‡æŽ’é™¤
      Ã— åŒã˜ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é‡è¤‡ã—ã¦é€ä¿¡ã—ãªã„ (3584 ms)
    ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
      Ã— ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã‚’é©åˆ‡ã«å‡¦ç†ã™ã‚‹ (3529 ms)
      Ã— APIã‚¨ãƒ©ãƒ¼ã‚’é©åˆ‡ã«å‡¦ç†ã™ã‚‹ (3533 ms)
    ãƒ¬ãƒ¼ãƒˆåˆ¶é™
      âˆš ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚’å°Šé‡ã™ã‚‹ (8 ms)
    å„ªå…ˆåº¦ã‚­ãƒ¥ãƒ¼
      âˆš å„ªå…ˆåº¦ã®é«˜ã„ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å…ˆã«å‡¦ç†ã™ã‚‹ (2 ms)

  â— DataAggregator â€º ãƒãƒƒãƒå‡¦ç† â€º ãƒãƒƒãƒã‚µã‚¤ã‚ºåˆ¶é™ã‚’å°Šé‡ã™ã‚‹

    No data available

      503 |     const result = await this.fetchOHLCV(symbol);
      504 |     if (result.success && result.data) return result.data;
    > 505 |     throw new Error(result.error || 'Fetch failed');
          |           ^
      506 |   }
      507 |
      508 |   /**

      at MarketDataClient.fetchData (app/infrastructure/api/data-aggregator.ts:505:11)
          at async Promise.all (index 0)
      at Object.<anonymous> (app/infrastructure/api/__tests__/DataAggregator.test.ts:104:23)

  â— DataAggregator â€º ãƒªã‚¯ã‚¨ã‚¹ãƒˆé‡è¤‡æŽ’é™¤ â€º åŒã˜ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é‡è¤‡ã—ã¦é€ä¿¡ã—ãªã„

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 37

      129 |       expect(result1).toEqual(mockData);
      130 |       expect(result2).toEqual(mockData);
    > 131 |       expect(fetchMock).toHaveBeenCalledTimes(1);
          |                         ^
      132 |     });
      133 |   });
      134 |

      at Object.toHaveBeenCalledTimes (app/infrastructure/api/__tests__/DataAggregator.test.ts:131:25)

  â— DataAggregator â€º ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° â€º ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã‚’é©åˆ‡ã«å‡¦ç†ã™ã‚‹

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: [{"close": 102, "date": "2024-01-01", "high": 105, "low": 95, "open": 100, "symbol": "AAPL", "volume": 1000}]

      137 |       fetchMock.mockRejectedValueOnce(new Error('Network error'));
      138 |
    > 139 |       await expect(aggregator.fetchData('AAPL')).rejects.toThrow('Network error');
          |                   ^
      140 |     });
      141 |
      142 |     it('APIã‚¨ãƒ©ãƒ¼ã‚’é©åˆ‡ã«å‡¦ç†ã™ã‚‹', async () => {

      at expect (node_modules/jest-circus/node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (app/infrastructure/api/__tests__/DataAggregator.test.ts:139:19)

  â— DataAggregator â€º ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° â€º APIã‚¨ãƒ©ãƒ¼ã‚’é©åˆ‡ã«å‡¦ç†ã™ã‚‹

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: [{"close": 102, "date": "2024-01-01", "high": 105, "low": 95, "open": 100, "symbol": "AAPL", "volume": 1000}]

      147 |       });
      148 |
    > 149 |       await expect(aggregator.fetchData('AAPL')).rejects.toThrow();
          |                   ^
      150 |     });
      151 |   });
      152 |

      at expect (node_modules/jest-circus/node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (app/infrastructure/api/__tests__/DataAggregator.test.ts:149:19)

Test Suites: 1 failed, 1 total
Tests:       4 failed, 7 passed, 11 total
Snapshots:   0 total
Time:        12.295 s
Ran all test suites matching /app\\infrastructure\\api\\__tests__\\DataAggregator.test.ts/i.
