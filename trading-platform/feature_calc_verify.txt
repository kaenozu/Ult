FAIL app/lib/services/__tests__/feature-calculation-service.test.ts
  Utils Test Utils Dummy
    √ should pass (2 ms)
  FeatureCalculationService
    calculateFeatures
      √ should calculate all features correctly (3 ms)
      √ should return valid numeric values for all features (2 ms)
      √ should calculate RSI correctly (1 ms)
      √ should calculate RSI change correctly (1 ms)
      √ should calculate SMA deviation correctly
      √ should calculate volume ratio correctly
      √ should calculate price momentum correctly (1 ms)
      √ should calculate MACD signal difference correctly (1 ms)
      √ should calculate Bollinger position correctly (1 ms)
      √ should calculate ATR percent correctly (1 ms)
    edge cases
      √ should handle empty indicator arrays
      √ should handle single data point (1 ms)
      √ should handle zero volume
      √ should handle zero price (1 ms)
      √ should handle NaN in indicators
      √ should handle very small prices (4 ms)
      √ should handle very large prices (1 ms)
      √ should handle zero SMA value
      √ should handle missing RSI values for change calculation (1 ms)
      √ should handle Bollinger bands at same level
    calculatePriceMomentum
      √ should calculate momentum for sufficient data (1 ms)
      √ should return zero for insufficient data
      √ should handle negative momentum (1 ms)
      √ should handle zero momentum
      √ should handle custom period (1 ms)
    volatility calculation
      × should calculate volatility from price data (1 ms)
      √ should return zero volatility for constant prices (1 ms)
    integration scenarios
      √ should handle typical market data (1 ms)
      √ should handle bull market scenario (1 ms)
      √ should handle bear market scenario (1 ms)
      √ should handle high volume scenario (1 ms)
    calculateEnhancedFeatures
      √ should calculate both basic and enhanced features (1 ms)
      √ should return valid candlestick pattern features (1 ms)
      √ should return valid price trajectory features (1 ms)
      √ should return valid volume profile features
      √ should return valid volatility regime features
      √ should maintain backward compatibility with basic features (1 ms)
      √ should handle empty data gracefully
      × should increase feature dimensionality significantly (1 ms)
    calculateFeaturesOptimized - TODO: implement method
      ○ skipped should produce same results as original implementation
      ○ skipped should handle TypedArray data efficiently
      ○ skipped should calculate momentum with zero-copy slicing
      ○ skipped should calculate volatility using iterators
      ○ skipped should calculate volume ratio efficiently

  ● FeatureCalculationService › volatility calculation › should calculate volatility from price data

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

      324 |       const volatileFeatures = service.calculateFeatures(volatileData, mockIndicators);
      325 |       
    > 326 |       expect(volatileFeatures.volatility).toBeGreaterThan(stableFeatures.volatility);
          |                                           ^
      327 |     });
      328 |
      329 |     it('should return zero volatility for constant prices', () => {

      at Object.toBeGreaterThan (app/lib/services/__tests__/feature-calculation-service.test.ts:326:43)

  ● FeatureCalculationService › calculateEnhancedFeatures › should increase feature dimensionality significantly

    expect(received).toBeGreaterThanOrEqual(expected)

    Expected: >= 50
    Received:    29

      503 |       
      504 |       expect(basicCount).toBe(11);
    > 505 |       expect(enhancedCount).toBeGreaterThanOrEqual(50); // 11 + 40+ new features
          |                             ^
      506 |     });
      507 |   });
      508 |

      at Object.toBeGreaterThanOrEqual (app/lib/services/__tests__/feature-calculation-service.test.ts:505:29)

Test Suites: 1 failed, 1 total
Tests:       2 failed, 5 skipped, 38 passed, 45 total
Snapshots:   0 total
Time:        1.512 s
Ran all test suites matching /app\\lib\\services\\__tests__\\feature-calculation-service.test.ts/i.
