npm warn Expanding --ci to --cidr. This will stop working in the next major version of npm.

> trading-platform@0.1.0 test
> jest app/infrastructure/api/__tests__/DataAggregator.test.ts

  console.warn
    [2026-02-14T13:50:03.812Z] [WARN]  [Aggregator] Failed to update data for AAPL, using stale data.

    [0m [90m 84 |[39m     [36mconst[39m formatted [33m=[39m [36mthis[39m[33m.[39mformatMessage([32m'warn'[39m[33m,[39m message[33m,[39m context)[33m;[39m
     [90m 85 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39menableConsole) {
    [31m[1m>[22m[39m[90m 86 |[39m       console[33m.[39mwarn(formatted[33m,[39m data [33m?[39m[33m?[39m [32m''[39m)[33m;[39m
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 87 |[39m     }
     [90m 88 |[39m     [36mthis[39m[33m.[39maddLog({ timestamp[33m:[39m [36mnew[39m [33mDate[39m()[33m,[39m level[33m:[39m [32m'warn'[39m[33m,[39m message[33m,[39m context[33m,[39m data })[33m;[39m
     [90m 89 |[39m   }[0m

      at Logger.warn (app/core/logger.ts:86:15)
      at warn (app/infrastructure/api/data-aggregator.ts:226:24)

  console.warn
    [2026-02-14T13:50:07.394Z] [WARN]  [Aggregator] Failed to update data for AAPL, using stale data.

    [0m [90m 84 |[39m     [36mconst[39m formatted [33m=[39m [36mthis[39m[33m.[39mformatMessage([32m'warn'[39m[33m,[39m message[33m,[39m context)[33m;[39m
     [90m 85 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39menableConsole) {
    [31m[1m>[22m[39m[90m 86 |[39m       console[33m.[39mwarn(formatted[33m,[39m data [33m?[39m[33m?[39m [32m''[39m)[33m;[39m
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 87 |[39m     }
     [90m 88 |[39m     [36mthis[39m[33m.[39maddLog({ timestamp[33m:[39m [36mnew[39m [33mDate[39m()[33m,[39m level[33m:[39m [32m'warn'[39m[33m,[39m message[33m,[39m context[33m,[39m data })[33m;[39m
     [90m 89 |[39m   }[0m

      at Logger.warn (app/core/logger.ts:86:15)
      at warn (app/infrastructure/api/data-aggregator.ts:226:24)
      at MarketDataClient.fetchOHLCV (app/infrastructure/api/data-aggregator.ts:250:20)
      at MarketDataClient.fetchData (app/infrastructure/api/data-aggregator.ts:488:20)
      at Object.<anonymous> (app/infrastructure/api/__tests__/DataAggregator.test.ts:132:7)

  console.warn
    [2026-02-14T13:50:10.921Z] [WARN]  [Aggregator] Failed to update data for AAPL, using stale data.

    [0m [90m 84 |[39m     [36mconst[39m formatted [33m=[39m [36mthis[39m[33m.[39mformatMessage([32m'warn'[39m[33m,[39m message[33m,[39m context)[33m;[39m
     [90m 85 |[39m     [36mif[39m ([36mthis[39m[33m.[39mconfig[33m.[39menableConsole) {
    [31m[1m>[22m[39m[90m 86 |[39m       console[33m.[39mwarn(formatted[33m,[39m data [33m?[39m[33m?[39m [32m''[39m)[33m;[39m
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 87 |[39m     }
     [90m 88 |[39m     [36mthis[39m[33m.[39maddLog({ timestamp[33m:[39m [36mnew[39m [33mDate[39m()[33m,[39m level[33m:[39m [32m'warn'[39m[33m,[39m message[33m,[39m context[33m,[39m data })[33m;[39m
     [90m 89 |[39m   }[0m

      at Logger.warn (app/core/logger.ts:86:15)
      at warn (app/infrastructure/api/data-aggregator.ts:226:24)
      at MarketDataClient.fetchOHLCV (app/infrastructure/api/data-aggregator.ts:250:20)
      at MarketDataClient.fetchData (app/infrastructure/api/data-aggregator.ts:488:20)
      at Object.<anonymous> (app/infrastructure/api/__tests__/DataAggregator.test.ts:142:7)

FAIL app/infrastructure/api/__tests__/DataAggregator.test.ts (11.441 s)
  Utils Test Utils Dummy
    âˆš should pass (1 ms)
  DataAggregator
    ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½
      âˆš ãƒ‡ãƒ¼ã‚¿ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜ã—ã¦å–å¾—ã§ãã‚‹ (1 ms)
      âˆš TTLãŒåˆ‡ã‚ŒãŸã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯nullã‚’è¿”ã™ (21 ms)
      âˆš ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ã§ãã‚‹ (1 ms)
    ãƒãƒƒãƒå‡¦ç†
      âˆš è¤‡æ•°ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒãƒƒãƒã§å‡¦ç†ã§ãã‚‹ (8 ms)
      Ã— ãƒãƒƒãƒã‚µã‚¤ã‚ºåˆ¶é™ã‚’å°Šé‡ã™ã‚‹ (1 ms)
    ãƒªã‚¯ã‚¨ã‚¹ãƒˆé‡è¤‡æŽ’é™¤
      Ã— åŒã˜ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é‡è¤‡ã—ã¦é€ä¿¡ã—ãªã„ (3587 ms)
    ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
      Ã— ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã‚’é©åˆ‡ã«å‡¦ç†ã™ã‚‹ (3537 ms)
      Ã— APIã‚¨ãƒ©ãƒ¼ã‚’é©åˆ‡ã«å‡¦ç†ã™ã‚‹ (3521 ms)
    ãƒ¬ãƒ¼ãƒˆåˆ¶é™
      âˆš ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚’å°Šé‡ã™ã‚‹ (5 ms)
    å„ªå…ˆåº¦ã‚­ãƒ¥ãƒ¼
      Ã— å„ªå…ˆåº¦ã®é«˜ã„ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å…ˆã«å‡¦ç†ã™ã‚‹ (1 ms)

  â— DataAggregator â€º ãƒãƒƒãƒå‡¦ç† â€º ãƒãƒƒãƒã‚µã‚¤ã‚ºåˆ¶é™ã‚’å°Šé‡ã™ã‚‹

    No data available

      490 |       return result.data;
      491 |     }
    > 492 |     throw new Error(result.error || `Failed to fetch data for ${symbol}`);
          |           ^
      493 |   }
      494 |
      495 |   /**

      at MarketDataClient.fetchData (app/infrastructure/api/data-aggregator.ts:492:11)
          at async Promise.all (index 0)
      at Object.<anonymous> (app/infrastructure/api/__tests__/DataAggregator.test.ts:97:23)

  â— DataAggregator â€º ãƒªã‚¯ã‚¨ã‚¹ãƒˆé‡è¤‡æŽ’é™¤ â€º åŒã˜ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é‡è¤‡ã—ã¦é€ä¿¡ã—ãªã„

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 37

      122 |       expect(result1).toEqual(mockData);
      123 |       expect(result2).toEqual(mockData);
    > 124 |       expect(fetchMock).toHaveBeenCalledTimes(1);
          |                         ^
      125 |     });
      126 |   });
      127 |

      at Object.toHaveBeenCalledTimes (app/infrastructure/api/__tests__/DataAggregator.test.ts:124:25)

  â— DataAggregator â€º ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° â€º ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã‚’é©åˆ‡ã«å‡¦ç†ã™ã‚‹

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: [{"close": 102, "date": "2024-01-01", "high": 105, "low": 95, "open": 100, "symbol": "AAPL", "volume": 1000}]

      130 |       fetchMock.mockRejectedValueOnce(new Error('Network error'));
      131 |
    > 132 |       await expect(aggregator.fetchData('AAPL')).rejects.toThrow('Network error');
          |                   ^
      133 |     });
      134 |
      135 |     it('APIã‚¨ãƒ©ãƒ¼ã‚’é©åˆ‡ã«å‡¦ç†ã™ã‚‹', async () => {

      at expect (node_modules/jest-circus/node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (app/infrastructure/api/__tests__/DataAggregator.test.ts:132:19)

  â— DataAggregator â€º ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° â€º APIã‚¨ãƒ©ãƒ¼ã‚’é©åˆ‡ã«å‡¦ç†ã™ã‚‹

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: [{"close": 102, "date": "2024-01-01", "high": 105, "low": 95, "open": 100, "symbol": "AAPL", "volume": 1000}]

      140 |       });
      141 |
    > 142 |       await expect(aggregator.fetchData('AAPL')).rejects.toThrow();
          |                   ^
      143 |     });
      144 |   });
      145 |

      at expect (node_modules/jest-circus/node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (app/infrastructure/api/__tests__/DataAggregator.test.ts:142:19)

  â— DataAggregator â€º å„ªå…ˆåº¦ã‚­ãƒ¥ãƒ¼ â€º å„ªå…ˆåº¦ã®é«˜ã„ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å…ˆã«å‡¦ç†ã™ã‚‹

    No data available

      490 |       return result.data;
      491 |     }
    > 492 |     throw new Error(result.error || `Failed to fetch data for ${symbol}`);
          |           ^
      493 |   }
      494 |
      495 |   /**

      at MarketDataClient.fetchData (app/infrastructure/api/data-aggregator.ts:492:11)
          at async Promise.all (index 0)
      at Object.<anonymous> (app/infrastructure/api/__tests__/DataAggregator.test.ts:178:23)

Test Suites: 1 failed, 1 total
Tests:       5 failed, 6 passed, 11 total
Snapshots:   0 total
Time:        12.232 s
Ran all test suites matching /app\\infrastructure\\api\\__tests__\\DataAggregator.test.ts/i.
