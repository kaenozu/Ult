#!/bin/bash
# Pre-commit hook to prevent large files from being committed

# Maximum file size in bytes (10MB)
MAX_FILE_SIZE=10485760

# Color codes
RED='\033[0;31m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo "Checking for large files..."

# Get list of files being committed
files=$(git diff --cached --name-only --diff-filter=ACM)

large_files_found=false

for file in $files; do
    if [ -f "$file" ]; then
        file_size=$(stat -c%s "$file" 2>/dev/null || stat -f%z "$file" 2>/dev/null)
        
        if [ "$file_size" -gt "$MAX_FILE_SIZE" ]; then
            file_size_mb=$(echo "scale=2; $file_size / 1048576" | bc)
            echo -e "${RED}ERROR: File too large: $file (${file_size_mb}MB)${NC}"
            echo -e "${YELLOW}Maximum allowed size: 10MB${NC}"
            large_files_found=true
        fi
    fi
done

if [ "$large_files_found" = true ]; then
    echo ""
    echo -e "${RED}Commit aborted due to large files.${NC}"
    echo "Please:"
    echo "1. Remove large files from the commit"
    echo "2. Add them to .gitignore"
    echo "3. Consider using Git LFS for large binary files"
    exit 1
fi

echo "âœ“ No large files detected"
exit 0
