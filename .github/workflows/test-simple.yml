name: Simple Test Workflow

on:
  workflow_dispatch:
    inputs:
      pr_number:
        description: 'PR number to test'
        required: true
        type: string

jobs:
  test:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      issues: write
      pull-requests: read
    steps:
      - name: Install GitHub CLI
        run: |
          type -p curl >/dev/null || (apt update && apt install curl -y)
          curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg
          chmod go+r /usr/share/keyrings/githubcli-archive-keyring.gpg
          echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" | tee /etc/apt/sources.list.d/github-cli.list > /dev/null
          apt update
          apt install gh -y
          gh --version

      - name: Test GH CLI
        run: |
          echo "Testing gh cli..."
          gh auth status || echo "Not authenticated (expected in workflow)"

      - name: Get PR Info
        run: |
          PR_NUM="${{ github.event.inputs.pr_number }}"
          echo "Processing PR #$PR_NUM"
          
          # Get PR info
          PR_JSON=$(gh pr view $PR_NUM \
            --repo ${{ github.repository }} \
            --json number,title,author,comments \
            2>&1)
          
          echo "PR JSON response:"
          echo "$PR_JSON"
          
          # Check if successful
          if echo "$PR_JSON" | grep -q "error\|Error\|not found"; then
            echo "Error fetching PR"
            exit 1
          fi
          
          echo "Success!"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
