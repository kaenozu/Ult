---
name: project-stabilizer
description: Post-merge recovery and test stabilization specialist. Resolves inconsistencies after large merges and migrates to modern tech stack (TanStack Query, Zod, React 19).
version: 1.1.0
priority: high
auto_activate: true
---

# Project Stabilizer (ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå®‰å®šåŒ–ãƒã‚¹ã‚¿ãƒ¼)

å¤§è¦æ¨¡ãªãƒãƒ¼ã‚¸ã‚„æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã®åˆ·æ–°å¾Œã«ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å¥å…¨æ€§ã‚’è¿…é€Ÿã«å›å¾©ã—ã€æœ€é«˜æ°´æº–ã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°å“è³ªã‚’ç¶­æŒã™ã‚‹ãŸã‚ã®å°‚é–€ã‚¹ã‚­ãƒ«ã€‚

Post-merge recovery and modernization specialist. Rapidly restores project health after large merges or tech stack updates, maintaining the highest engineering quality standards.

## ğŸ¯ ç›®çš„
- ãƒãƒ¼ã‚¸å¾Œã®ãƒ†ã‚¹ãƒˆå¤±æ•—ã‚„å‹ã‚¨ãƒ©ãƒ¼ã®è¿…é€Ÿãªè§£æ¶ˆã€‚
- ãƒ¬ã‚¬ã‚·ãƒ¼ãªçŠ¶æ…‹ç®¡ç†ã‹ã‚‰ãƒ¢ãƒ€ãƒ³ãªéåŒæœŸçŠ¶æ…‹ç®¡ç†ï¼ˆTanStack Queryï¼‰ã¸ã®ç§»è¡Œã€‚
- React 19 ãŠã‚ˆã³ Next.js App Router ã«æœ€é©åŒ–ã•ã‚ŒãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆã®å¾¹åº•ã€‚
- å®Ÿè¡Œæ™‚ã®å‹å®‰å…¨æ€§ï¼ˆZodï¼‰ã¨ç’°å¢ƒå¤‰æ•°ã®ä¿è­·ã€‚

## ğŸ›  å°‚é–€çŸ¥è­˜ (Expertise)

### 1. ãƒãƒ¼ã‚¸å¾Œã®ä¸æ•´åˆè§£æ±º (Post-Merge Recovery)
- **ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªDBã®çµ±åˆ**: è¤‡æ•°ã®APIãƒ«ãƒ¼ãƒˆã§ç‹¬ç«‹ã—ã¦ã„ãŸã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªçŠ¶æ…‹ã‚’ `AuthStore` ç­‰ã®ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã¾ãŸã¯å…±æœ‰ã‚¹ãƒˆã‚¢ã«çµ±åˆã—ã€ãƒ†ã‚¹ãƒˆã®æ•´åˆæ€§ã‚’ä¿ã¤ã€‚
- **ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®æœ€é©åŒ–**: äºˆæ¸¬ãƒ­ã‚¸ãƒƒã‚¯ç­‰ã®é–¾å€¤åˆ¤å®šãŒå³ã—ã„å ´åˆã€ç¾å®Ÿçš„ãªã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ï¼ˆVå­—å›å¾©ç­‰ï¼‰ã‚’ã‚·ã‚°ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ãŸãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã«èª¿æ•´ã™ã‚‹ã€‚
- **ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®çµ±ä¸€**: `pnpm` ã¨ `npm` ã®æ··åœ¨ã‚’æ¤œçŸ¥ã—ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¨™æº–ï¼ˆç¾åœ¨ã¯ `npm`ï¼‰ã«ãƒ­ãƒƒã‚¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¼·åˆ¶çš„ã«ä¸€æœ¬åŒ–ã™ã‚‹ã€‚

### 2. ãƒ¢ãƒ€ãƒ³ãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒ (Modern Data Fetching)
- **useEffect ã‹ã‚‰ useQuery ã¸ã®ç§»è¡Œ**: æ‰‹å‹•ã® `fetch` + `useState` ã‚’ `TanStack Query` ã«ç½®ãæ›ãˆã€ç«¶åˆçŠ¶æ…‹ã€äºŒé‡ç™ºç«ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†ã‚’ä¸€å…ƒåŒ–ã™ã‚‹ã€‚
- **Zod ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**: APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«å¯¾ã—ã€TypeScript ã®å‹å®šç¾©ã ã‘ã§ãªãå®Ÿè¡Œæ™‚ã®ã‚¹ã‚­ãƒ¼ãƒæ¤œè¨¼ã‚’è¡Œã„ã€ä¸æ­£ãªãƒ‡ãƒ¼ã‚¿ã«ã‚ˆã‚‹ã‚µã‚¤ãƒ¬ãƒ³ãƒˆãªã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã‚’é˜²ãã€‚

### 3. React 19 æœ€é©åŒ–
- **Side Effect ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**: Effect å†…ã§ã®åŒæœŸçš„ãª `setState`ï¼ˆCascading Rendersï¼‰ã‚’æ’é™¤ã—ã€`useTransition` ã‚„ `useMemo`ã€ã¾ãŸã¯ `useQuery` ã®çŠ¶æ…‹ç§»è¡Œã‚’æ´»ç”¨ã™ã‚‹ã€‚
- **Ref ã‚¢ã‚¯ã‚»ã‚¹ã®é©æ­£åŒ–**: ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ä¸­ã® `ref.current` ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç¦æ­¢ã—ã€Effect ã¾ãŸã¯ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©å†…ã§ã®ã¿å‡¦ç†ã™ã‚‹ã€‚

### 4. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®é€²åŒ– (DDD)
- **ãƒ‰ãƒ¡ã‚¤ãƒ³åˆ†é›¢**: `app/lib` ã®è‚¥å¤§åŒ–ã‚’é˜²ããŸã‚ã€`app/features/[domain]` æ§‹é€ ã‚’å°å…¥ã—ã€ã‚µãƒ¼ãƒ“ã‚¹ã€ã‚¹ãƒˆã‚¢ã€ãƒ•ãƒƒã‚¯ã‚’ãƒ‰ãƒ¡ã‚¤ãƒ³ã”ã¨ã«ã‚«ãƒ—ã‚»ãƒ«åŒ–ã™ã‚‹ã€‚

## ğŸ“ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ (Workflow)

### Step 1: è¨ºæ–­ (Diagnosis)
`npm test` ã¨ `npm run lint` ã‚’å®Ÿè¡Œã—ã€ãƒãƒ¼ã‚¸å¾Œã®ã€ŒçœŸã®å¤±æ•—æ•°ã€ã‚’æŠŠæ¡ã™ã‚‹ã€‚

**å¿…é ˆã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œé †åº:**
```bash
cd trading-platform

# 1. ä¾å­˜é–¢ä¿‚ã®çŠ¶æ…‹ç¢ºèª
npm list --depth=0 2>&1 | grep -E "UNMET|missing" || echo "âœ“ Dependencies OK"

# 2. TypeScript å‹ãƒã‚§ãƒƒã‚¯ (æœ€å„ªå…ˆ)
npx tsc --noEmit

# 3. ESLint é™çš„è§£æ
npm run lint

# 4. ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm test -- --passWithNoTests --coverage

# 5. ãƒ“ãƒ«ãƒ‰æ¤œè¨¼
npm run build
```

**Expected Output - å¥å…¨ãªçŠ¶æ…‹:**
```
âœ“ Dependencies OK
âœ“ TypeScript: 0 errors
âœ“ ESLint: 0 errors, 0 warnings
âœ“ Tests: 247 passed, 0 failed
âœ“ Coverage: 82.5% (above threshold)
âœ“ Build: completed in 45s
```

**Expected Output - å•é¡ŒãŒã‚ã‚‹å ´åˆ:**
```
âœ— TypeScript: 15 errors found
  - app/lib/auth/AuthStore.ts(42,15): Property 'userId' does not exist
  - app/components/Login.tsx(28,3): Type 'string | undefined' is not assignable
  
âœ— ESLint: 23 errors, 47 warnings
  - @typescript-eslint/no-explicit-any: 12 occurrences
  - react-hooks/exhaustive-deps: 11 warnings
  
âœ— Tests: 198 passed, 49 failed
  - FAIL app/lib/__tests__/AuthService.test.ts
    â— AuthService â€º authenticates user
      expect(received).toBe(expected)
      Expected: true
      Received: undefined
      
âœ— Coverage: 67.3% (below 80% threshold)
```

**è¨ºæ–­ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ:**
- [ ] ä¾å­˜é–¢ä¿‚ã®ç«¶åˆãŒãªã„ã‹ç¢ºèª
- [ ] TypeScript ã‚¨ãƒ©ãƒ¼ã®ç®‡æ‰€ã¨ç¨®é¡ã‚’è¨˜éŒ²
- [ ] ESLint ã‚¨ãƒ©ãƒ¼ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’åˆ†é¡
- [ ] å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã®å…±é€šåŸå› ã‚’ç‰¹å®š
- [ ] ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚Œã°æœ€å„ªå…ˆã§å¯¾å‡¦

### Step 2: åŸºç›¤ä¿®å¾© (Base Fix)
èªè¨¼ã‚„ç’°å¢ƒå¤‰æ•°ãªã©ã€ã‚·ã‚¹ãƒ†ãƒ ã®æ ¹å¹¹ã«é–¢ã‚ã‚‹ä¸æ•´åˆã‚’ `AuthStore` ã‚„ `env.ts` ã®å°å…¥ã«ã‚ˆã‚Šæœ€å„ªå…ˆã§ä¿®æ­£ã™ã‚‹ã€‚

**ã‚·ãƒŠãƒªã‚ª 1: åˆ†æ•£ã—ãŸèªè¨¼çŠ¶æ…‹ã®çµ±åˆ**

**Before: Scattered authentication state**
```typescript
// âŒ Problem: 3ç®‡æ‰€ã§ç‹¬ç«‹ã—ãŸçŠ¶æ…‹ç®¡ç†
// app/api/auth/route.ts
let currentUser: User | null = null; // APIç”¨ã®çŠ¶æ…‹

// app/components/Login.tsx
const [user, setUser] = useState<User | null>(null); // UIç”¨ã®çŠ¶æ…‹

// app/lib/websocket/WebSocketService.ts
private authenticatedUser?: User; // WebSocketç”¨ã®çŠ¶æ…‹
```

**Issue:** ãƒ†ã‚¹ãƒˆã§èªè¨¼ã™ã‚‹ã¨ã€APIã¯èªè¨¼æ¸ˆã¿ã ãŒUIã¯æœªèªè¨¼ã®ã¾ã¾ã€‚ä¸æ•´åˆã«ã‚ˆã‚Šãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹ã€‚

**After: Centralized AuthStore**
```typescript
// âœ… Solution: ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã§çŠ¶æ…‹ã‚’ä¸€å…ƒç®¡ç†
// app/lib/auth/AuthStore.ts
export class AuthStore {
  private static instance: AuthStore;
  private users = new Map<string, User>();
  private currentUser: User | null = null;
  
  static getInstance(): AuthStore {
    if (!AuthStore.instance) {
      AuthStore.instance = new AuthStore();
    }
    return AuthStore.instance;
  }
  
  register(user: User): void {
    this.users.set(user.email, user);
  }
  
  authenticate(email: string, password: string): User | null {
    const user = this.users.get(email);
    if (user && user.password === password) {
      this.currentUser = user;
      return user;
    }
    return null;
  }
  
  getCurrentUser(): User | null {
    return this.currentUser;
  }
  
  logout(): void {
    this.currentUser = null;
  }
  
  // ãƒ†ã‚¹ãƒˆç”¨: å®Œå…¨ãƒªã‚»ãƒƒãƒˆ
  reset(): void {
    this.users.clear();
    this.currentUser = null;
  }
}

// app/lib/auth/index.ts
export const authStore = AuthStore.getInstance();
```

**Migration Steps:**
```bash
# 1. AuthStore ã‚’ä½œæˆ
touch app/lib/auth/AuthStore.ts

# 2. æ—¢å­˜ã®APIãƒ«ãƒ¼ãƒˆã‚’æ›´æ–°
# app/api/auth/route.ts ã‚’ authStore ã‚’ä½¿ã†ã‚ˆã†ã«æ›¸ãæ›ãˆ

# 3. UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æ›´æ–°
# useAuthStore() ãƒ•ãƒƒã‚¯ã‚’ä½œæˆã—ã¦Zustandã§è³¼èª­

# 4. ãƒ†ã‚¹ãƒˆã§ãƒªã‚»ãƒƒãƒˆå‡¦ç†ã‚’è¿½åŠ 
# beforeEach(() => authStore.reset())

# 5. æ¤œè¨¼
npm test -- AuthStore.test.ts
npm test -- Login.test.tsx
npm test -- auth
```

**ã‚·ãƒŠãƒªã‚ª 2: ç’°å¢ƒå¤‰æ•°ã®å®Ÿè¡Œæ™‚æ¤œè¨¼**

**Before: Runtime errors from missing env vars**
```typescript
// âŒ Problem: å®Ÿè¡Œæ™‚ã¾ã§ç’°å¢ƒå¤‰æ•°ã®ä¸è¶³ã«æ°—ã¥ã‹ãªã„
// app/lib/api/AlphaVantageClient.ts
const API_KEY = process.env.ALPHA_VANTAGE_API_KEY; // undefined ã§ã‚‚ç¶šè¡Œ
const response = await fetch(`https://api.alphavantage.co/query?apikey=${API_KEY}`);
// æœ¬ç•ªã§ "undefined" ãŒé€ä¿¡ã•ã‚Œã¦å¤±æ•—
```

**After: Type-safe environment validation**
```typescript
// âœ… Solution: èµ·å‹•æ™‚ã« Zod ã§æ¤œè¨¼
// app/lib/env.ts
import { z } from 'zod';

const envSchema = z.object({
  ALPHA_VANTAGE_API_KEY: z.string().min(1, 'Alpha Vantage API key is required'),
  NEXT_PUBLIC_WS_URL: z.string().url('WebSocket URL must be valid'),
  NODE_ENV: z.enum(['development', 'test', 'production']),
});

export const env = envSchema.parse({
  ALPHA_VANTAGE_API_KEY: process.env.ALPHA_VANTAGE_API_KEY,
  NEXT_PUBLIC_WS_URL: process.env.NEXT_PUBLIC_WS_URL,
  NODE_ENV: process.env.NODE_ENV,
});

// app/lib/api/AlphaVantageClient.ts
import { env } from '@/lib/env';

const response = await fetch(
  `https://api.alphavantage.co/query?apikey=${env.ALPHA_VANTAGE_API_KEY}`
);
// å‹å®‰å…¨ + èµ·å‹•æ™‚æ¤œè¨¼ã€‚undefined ã¯çµ¶å¯¾ã«æ¥ãªã„
```

**Verification:**
```bash
# ç’°å¢ƒå¤‰æ•°ãªã—ã§èµ·å‹•ã™ã‚‹ã¨å³åº§ã«ã‚¨ãƒ©ãƒ¼
$ npm run dev

ZodError: [
  {
    "code": "too_small",
    "minimum": 1,
    "path": ["ALPHA_VANTAGE_API_KEY"],
    "message": "Alpha Vantage API key is required"
  }
]

# .env.local ã‚’è¨­å®šå¾Œ
$ npm run dev
âœ“ Ready on http://localhost:3000
```

### Step 3: UI/ãƒ­ã‚¸ãƒƒã‚¯ã®å®‰å®šåŒ–
å£Šã‚ŒãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆã‚’ã€æœ€æ–°ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆRTLç­‰ï¼‰ã®ãƒ‘ã‚¹ã«åˆã‚ã›ã¦ä¿®æ­£ã™ã‚‹ã€‚

**ã‚·ãƒŠãƒªã‚ª 1: React 19 äº’æ›ãƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³**

**Before: Using old testing patterns**
```typescript
// âŒ Problem: React 18 ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒ React 19 ã§è­¦å‘Š
import { render } from '@testing-library/react';

test('renders component', () => {
  const { getByText } = render(<MyComponent />);
  expect(getByText('Hello')).toBeInTheDocument();
  // Warning: ReactDOM.render is no longer supported in React 19
});
```

**After: React 19 compatible patterns**
```typescript
// âœ… Solution: screen ã‚’ä½¿ã„ã€async/await ã§å®‰å®šåŒ–
import { render, screen, waitFor } from '@testing-library/react';
import { expect, test } from '@jest/globals';

test('renders component with modern patterns', async () => {
  render(<MyComponent />);
  
  // findBy* ã¯è¦ç´ ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¾ã§å¾…æ©Ÿ
  const element = await screen.findByText('Hello');
  expect(element).toBeDefined();
  expect(element).toBeVisible();
});

test('handles async state updates', async () => {
  render(<MyComponent />);
  
  const button = screen.getByRole('button', { name: /click me/i });
  await userEvent.click(button);
  
  // çŠ¶æ…‹æ›´æ–°ã‚’å¾…æ©Ÿ
  await waitFor(() => {
    expect(screen.getByText('Clicked!')).toBeInTheDocument();
  });
});
```

**ã‚·ãƒŠãƒªã‚ª 2: ãƒ¢ãƒƒã‚¯ã®æœ€å°åŒ–**

**Before: Over-mocked tests**
```typescript
// âŒ Problem: å®Ÿè£…ã®è©³ç´°ã‚’ãƒ¢ãƒƒã‚¯ã€‚ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã§å£Šã‚Œã‚‹
jest.mock('@/lib/MarketDataService', () => ({
  MarketDataService: {
    getInstance: jest.fn(() => ({
      fetchStockData: jest.fn(() => Promise.resolve(mockData)),
      getCachedData: jest.fn(() => mockData),
      invalidateCache: jest.fn(),
    })),
  },
}));

test('displays stock price', async () => {
  render(<StockCard symbol="AAPL" />);
  await screen.findByText('$150.00');
  // ãƒ†ã‚¹ãƒˆã¯ãƒ‘ã‚¹ã™ã‚‹ãŒã€å®Ÿéš›ã®ã‚µãƒ¼ãƒ“ã‚¹ã®çµ±åˆã‚’ãƒ†ã‚¹ãƒˆã—ã¦ã„ãªã„
});
```

**After: Integration-focused tests**
```typescript
// âœ… Solution: ãƒ¢ãƒƒã‚¯ã¯å¤–éƒ¨ä¾å­˜ã®ã¿ã€‚å†…éƒ¨ãƒ­ã‚¸ãƒƒã‚¯ã¯å®Ÿéš›ã«å®Ÿè¡Œ
import { MarketDataService } from '@/lib/MarketDataService';

// å¤–éƒ¨APIå‘¼ã³å‡ºã—ã®ã¿ãƒ¢ãƒƒã‚¯
jest.mock('@/lib/api/AlphaVantageClient', () => ({
  fetchFromAPI: jest.fn(() => Promise.resolve({
    '01. symbol': 'AAPL',
    '05. price': 150.00,
  })),
}));

test('displays stock price from real service', async () => {
  // å®Ÿéš›ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½¿ç”¨
  const service = MarketDataService.getInstance();
  
  render(<StockCard symbol="AAPL" />);
  
  // ã‚µãƒ¼ãƒ“ã‚¹ã®å…¨ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã€å¤‰æ›ç­‰ï¼‰ã‚’å®Ÿè¡Œ
  await waitFor(() => {
    expect(screen.getByText('$150.00')).toBeInTheDocument();
  });
  
  // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚‚å®Ÿéš›ã«æ©Ÿèƒ½ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
  render(<StockCard symbol="AAPL" />);
  await screen.findByText('$150.00'); // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
});
```

**ã‚·ãƒŠãƒªã‚ª 3: useEffect ã®ä¾å­˜é…åˆ—å•é¡Œ**

**Before: Infinite render loops**
```typescript
// âŒ Problem: ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä¾å­˜é…åˆ—ã«å…¥ã‚Œã‚‹ã¨ç„¡é™ãƒ«ãƒ¼ãƒ—
function useStockData(config: StockConfig) {
  const [data, setData] = useState(null);
  
  useEffect(() => {
    fetchData(config).then(setData);
  }, [config]); // config ã¯æ¯å›æ–°ã—ã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ â†’ ç„¡é™ãƒ«ãƒ¼ãƒ—
  
  return data;
}

// å‘¼ã³å‡ºã—å´
<StockChart config={{ symbol: 'AAPL', interval: '1D' }} />
```

**After: Stable dependencies or TanStack Query**
```typescript
// âœ… Solution 1: ä¾å­˜é…åˆ—ã‚’å®‰å®šåŒ–
function useStockData(symbol: string, interval: string) {
  const [data, setData] = useState(null);
  
  useEffect(() => {
    fetchData({ symbol, interval }).then(setData);
  }, [symbol, interval]); // ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å€¤ã®ã¿
  
  return data;
}

// å‘¼ã³å‡ºã—å´
<StockChart symbol="AAPL" interval="1D" />

// âœ… Solution 2: TanStack Query ã§ useEffect ä¸è¦
function useStockData(symbol: string, interval: string) {
  return useQuery({
    queryKey: ['stock', symbol, interval],
    queryFn: () => fetchData({ symbol, interval }),
    staleTime: 60000, // 1åˆ†é–“ã‚­ãƒ£ãƒƒã‚·ãƒ¥
  });
}

// è‡ªå‹•çš„ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã€å†å–å¾—ã€ã‚¨ãƒ©ãƒ¼å‡¦ç†
const { data, isLoading, error } = useStockData('AAPL', '1D');
```

**Verification Steps:**
```bash
# 1. å€‹åˆ¥ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ
npm test -- StockCard.test.tsx

# 2. çµ±åˆãƒ†ã‚¹ãƒˆ
npm test -- integration/

# 3. ã‚«ãƒãƒ¬ãƒƒã‚¸ç¢ºèª
npm test -- --coverage --collectCoverageFrom="app/components/**/*.tsx"

# 4. ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ç¢ºèªï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
npm run dev
# ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost:3000/test-components
```

### Step 4: ãƒ¢ãƒ€ãƒ³åŒ– (Modernization)
ä¿®æ­£ã—ãŸç®‡æ‰€ã‚’é †æ¬¡ TanStack Query ã‚„ Zod ã‚’ç”¨ã„ãŸãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚³ãƒ¼ãƒ‰ã«æ˜‡è¯ã•ã›ã‚‹ã€‚

**Complete Migration Example: Manual fetch â†’ TanStack Query + Zod**

**Before: Manual fetch with useEffect (å•é¡ŒãŒå¤šã„)**
```typescript
// âŒ Problems:
// 1. ç«¶åˆçŠ¶æ…‹: é€£ç¶šã‚¯ãƒªãƒƒã‚¯ã§å¤ã„ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒä¸Šæ›¸ã
// 2. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãªã—: åŒã˜ãƒ‡ãƒ¼ã‚¿ã‚’ä½•åº¦ã‚‚å–å¾—
// 3. ã‚¨ãƒ©ãƒ¼å‡¦ç†ãŒä¸å®Œå…¨
// 4. ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã®ç®¡ç†ãŒè¤‡é›‘
// 5. å‹å®‰å…¨æ€§ãªã—: APIå¤‰æ›´ã«æ°—ã¥ã‹ãªã„

// app/components/StockDashboard.tsx
const [data, setData] = useState<any>(null); // any å‹
const [loading, setLoading] = useState(true);
const [error, setError] = useState<Error | null>(null);

useEffect(() => {
  let cancelled = false;
  
  setLoading(true);
  setError(null);
  
  fetch('/api/stocks?symbol=AAPL')
    .then(res => res.json())
    .then(json => {
      if (!cancelled) {
        setData(json); // å‹ãƒã‚§ãƒƒã‚¯ãªã—
        setLoading(false);
      }
    })
    .catch(err => {
      if (!cancelled) {
        setError(err);
        setLoading(false);
      }
    });
  
  return () => { cancelled = true; };
}, []);

if (loading) return <div>Loading...</div>;
if (error) return <div>Error: {error.message}</div>;
if (!data) return null;

return <div>{data.price}</div>; // data.price ãŒ undefined ã§ã‚‚ã‚¨ãƒ©ãƒ¼ãªã—
```

**After: TanStack Query with Zod validation (ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹)**

**Step 1: Define Zod schema**
```typescript
// app/lib/schemas/stock.ts
import { z } from 'zod';

export const StockDataSchema = z.object({
  symbol: z.string().min(1).max(10),
  price: z.number().positive(),
  change: z.number(),
  changePercent: z.number(),
  volume: z.number().int().nonnegative(),
  lastUpdated: z.string().datetime(),
});

export type StockData = z.infer<typeof StockDataSchema>;
```

**Step 2: Create type-safe API client**
```typescript
// app/lib/api/stockClient.ts
import { StockDataSchema, type StockData } from '@/lib/schemas/stock';

export async function fetchStockData(symbol: string): Promise<StockData> {
  const response = await fetch(`/api/stocks?symbol=${encodeURIComponent(symbol)}`);
  
  if (!response.ok) {
    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
  }
  
  const json = await response.json();
  
  // å®Ÿè¡Œæ™‚ã«å‹ã‚’æ¤œè¨¼ã€‚APIå¤‰æ›´ãŒã‚ã‚Œã°ã“ã“ã§å³åº§ã«ã‚¨ãƒ©ãƒ¼
  try {
    return StockDataSchema.parse(json);
  } catch (error) {
    if (error instanceof z.ZodError) {
      console.error('API response validation failed:', error.errors);
      console.error('Received data:', json);
      throw new Error(`Invalid API response: ${error.errors[0].message}`);
    }
    throw error;
  }
}
```

**Step 3: Create custom hook with TanStack Query**
```typescript
// app/hooks/useStockData.ts
import { useQuery } from '@tanstack/react-query';
import { fetchStockData } from '@/lib/api/stockClient';
import type { StockData } from '@/lib/schemas/stock';

interface UseStockDataOptions {
  symbol: string;
  refetchInterval?: number;
  enabled?: boolean;
}

export function useStockData({ 
  symbol, 
  refetchInterval = 60000, // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ1åˆ†
  enabled = true 
}: UseStockDataOptions) {
  return useQuery({
    queryKey: ['stock', symbol],
    queryFn: () => fetchStockData(symbol),
    staleTime: 30000, // 30ç§’é–“ã¯æ–°é®®
    refetchInterval,
    enabled,
    retry: 3,
    retryDelay: attemptIndex => Math.min(1000 * 2 ** attemptIndex, 30000),
  });
}
```

**Step 4: Use in component**
```typescript
// app/components/StockDashboard.tsx
import { useStockData } from '@/hooks/useStockData';

export function StockDashboard({ symbol }: { symbol: string }) {
  const { data, isLoading, error, refetch } = useStockData({ 
    symbol,
    refetchInterval: 60000 
  });
  
  // âœ… Benefits:
  // - è‡ªå‹•ã‚­ãƒ£ãƒƒã‚·ãƒ¥: åŒã˜ã‚·ãƒ³ãƒœãƒ«ã¯å†åˆ©ç”¨
  // - è‡ªå‹•å†è©¦è¡Œ: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã§3å›ãƒªãƒˆãƒ©ã‚¤
  // - ç«¶åˆçŠ¶æ…‹ãªã—: æœ€æ–°ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã¿é©ç”¨
  // - å®Œå…¨ãªå‹å®‰å…¨æ€§: data ã¯ StockData å‹
  // - è‡ªå‹•ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥: 1åˆ†ã”ã¨ã«æ›´æ–°
  
  if (isLoading) {
    return <div className="animate-pulse">Loading {symbol}...</div>;
  }
  
  if (error) {
    return (
      <div className="error">
        <p>Failed to load {symbol}: {error.message}</p>
        <button onClick={() => refetch()}>Retry</button>
      </div>
    );
  }
  
  // data ã¯å¿…ãš StockData å‹ã€‚undefined ãƒã‚§ãƒƒã‚¯ä¸è¦
  return (
    <div>
      <h2>{data.symbol}</h2>
      <p className="price">${data.price.toFixed(2)}</p>
      <p className={data.change >= 0 ? 'positive' : 'negative'}>
        {data.change >= 0 ? '+' : ''}{data.changePercent.toFixed(2)}%
      </p>
      <p className="volume">Volume: {data.volume.toLocaleString()}</p>
      <p className="updated">Updated: {new Date(data.lastUpdated).toLocaleString()}</p>
    </div>
  );
}
```

**Step 5: Setup QueryClient provider**
```typescript
// app/layout.tsx
'use client';

import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { ReactQueryDevtools } from '@tanstack/react-query-devtools';
import { useState } from 'react';

export default function RootLayout({ children }: { children: React.ReactNode }) {
  const [queryClient] = useState(() => new QueryClient({
    defaultOptions: {
      queries: {
        staleTime: 60000,
        retry: 2,
      },
    },
  }));
  
  return (
    <html lang="ja">
      <body>
        <QueryClientProvider client={queryClient}>
          {children}
          {process.env.NODE_ENV === 'development' && <ReactQueryDevtools />}
        </QueryClientProvider>
      </body>
    </html>
  );
}
```

**Testing the modernized code:**
```typescript
// app/hooks/__tests__/useStockData.test.tsx
import { renderHook, waitFor } from '@testing-library/react';
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { useStockData } from '../useStockData';
import * as stockClient from '@/lib/api/stockClient';

jest.mock('@/lib/api/stockClient');

function createWrapper() {
  const queryClient = new QueryClient({
    defaultOptions: {
      queries: { retry: false },
    },
  });
  return ({ children }: { children: React.ReactNode }) => (
    <QueryClientProvider client={queryClient}>
      {children}
    </QueryClientProvider>
  );
}

test('fetches and caches stock data', async () => {
  const mockData = {
    symbol: 'AAPL',
    price: 150.00,
    change: 2.50,
    changePercent: 1.69,
    volume: 50000000,
    lastUpdated: '2024-01-01T12:00:00Z',
  };
  
  jest.spyOn(stockClient, 'fetchStockData').mockResolvedValue(mockData);
  
  const { result } = renderHook(() => useStockData({ symbol: 'AAPL' }), {
    wrapper: createWrapper(),
  });
  
  expect(result.current.isLoading).toBe(true);
  
  await waitFor(() => expect(result.current.isSuccess).toBe(true));
  
  expect(result.current.data).toEqual(mockData);
  expect(stockClient.fetchStockData).toHaveBeenCalledTimes(1);
});
```

**Migration Checklist:**
```bash
# 1. Install dependencies
npm install @tanstack/react-query @tanstack/react-query-devtools zod

# 2. Create schemas
mkdir -p app/lib/schemas
touch app/lib/schemas/stock.ts

# 3. Update API clients
# Add Zod validation to all API clients

# 4. Create custom hooks
mkdir -p app/hooks
touch app/hooks/useStockData.ts

# 5. Setup QueryClient
# Update app/layout.tsx

# 6. Migrate components one by one
# Start with leaf components, work up to parents

# 7. Run tests
npm test -- useStockData.test.tsx
npm test -- StockDashboard.test.tsx

# 8. Verify no regressions
npm test
npm run build
```

**Performance Impact:**
```
Before (manual fetch):
- Initial load: 850ms
- Re-renders: 12
- Network requests: 8 (no cache)
- Bundle size: +0KB

After (TanStack Query + Zod):
- Initial load: 720ms (-15%)
- Re-renders: 3 (-75%)
- Network requests: 1 (cached)
- Bundle size: +45KB (query: 38KB, zod: 7KB)

ROI: Improved UX, better DX, fewer bugs
```

### Step 5: ä¸€æ‹¬çµ±åˆ (Orchestration)
è¤‡æ•°ã®PRã‚„ç«¶åˆãƒ–ãƒ©ãƒ³ãƒã‚’ã€ä¾å­˜é–¢ä¿‚ã‚’è€ƒæ…®ã—ãªãŒã‚‰é †æ¬¡ `main` ã¸çµ±åˆã—ã€æœ€çµ‚çš„ãªå¥å…¨æ€§ã‚’å…¨ä»¶ãƒ†ã‚¹ãƒˆã§è¨¼æ˜ã™ã‚‹ã€‚

**Complete Integration Workflow**

**Phase 1: Pre-Integration Preparation**
```bash
# 1. ç¾åœ¨ã®ãƒ–ãƒ©ãƒ³ãƒã®çŠ¶æ…‹ç¢ºèª
git checkout feature/my-branch
git status

# 2. æœ€æ–°ã® main ã‚’å–å¾—
git fetch origin main

# 3. ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒãƒ¼ã‚¸ãƒ†ã‚¹ãƒˆï¼ˆã‚³ãƒŸãƒƒãƒˆã—ãªã„ï¼‰
git merge --no-commit --no-ff origin/main

# 4. ç«¶åˆãŒã‚ã‚Œã°è§£æ±º
git diff --name-only --diff-filter=U
# å„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¦ç«¶åˆè§£æ±º

# 5. çµ±åˆå¾Œã®ãƒ†ã‚¹ãƒˆ
npm install  # ä¾å­˜é–¢ä¿‚ã‚’æ›´æ–°
npm test
npm run lint
npm run build

# 6. å•é¡Œãªã‘ã‚Œã°ãƒãƒ¼ã‚¸ã‚’ã‚³ãƒŸãƒƒãƒˆ
git commit -m "chore: merge main into feature/my-branch"
```

**Phase 2: Dependency-Ordered Integration**

**Scenario: 3ã¤ã®ãƒ–ãƒ©ãƒ³ãƒã‚’çµ±åˆ**
- `feature/auth-store` - èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
- `feature/data-fetching` - TanStack Query ã¸ã®ç§»è¡Œï¼ˆauth-store ã«ä¾å­˜ï¼‰
- `feature/ui-improvements` - UIæ”¹å–„ï¼ˆdata-fetching ã«ä¾å­˜ï¼‰

**Step-by-Step Integration:**
```bash
# 1. æœ€ã‚‚åŸºç›¤ã¨ãªã‚‹ auth-store ã‹ã‚‰é–‹å§‹
git checkout main
git pull origin main

git checkout feature/auth-store
git rebase main  # æœ€æ–°ã® main ä¸Šã«ãƒªãƒ™ãƒ¼ã‚¹

# ãƒ­ãƒ¼ã‚«ãƒ«æ¤œè¨¼
npm install
npm test && npm run lint && npm run build

# å•é¡Œãªã‘ã‚Œã° main ã«ãƒãƒ¼ã‚¸
git checkout main
git merge --no-ff feature/auth-store -m "feat: implement centralized AuthStore"

# CI ãŒé€šã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ã‹ã‚‰ push
git push origin main

# 2. æ¬¡ã®ä¾å­˜ãƒ–ãƒ©ãƒ³ãƒ data-fetching
git checkout feature/data-fetching
git rebase main  # auth-store ã‚’å«ã‚€æœ€æ–° main ã‚’å–å¾—

# çµ±åˆãƒ†ã‚¹ãƒˆ: auth + data-fetching
npm install
npm test -- --coverage
npm run test:e2e  # E2Eãƒ†ã‚¹ãƒˆã§çµ±åˆã‚’æ¤œè¨¼

# å•é¡Œãªã‘ã‚Œã° main ã«ãƒãƒ¼ã‚¸
git checkout main
git merge --no-ff feature/data-fetching -m "feat: migrate to TanStack Query"
git push origin main

# 3. æœ€çµ‚ãƒ–ãƒ©ãƒ³ãƒ ui-improvements
git checkout feature/ui-improvements
git rebase main

# å…¨ä½“çµ±åˆãƒ†ã‚¹ãƒˆ
npm install
npm test
npm run test:e2e
npm run build

# Performance regression check
npm run test:performance  # ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

git checkout main
git merge --no-ff feature/ui-improvements -m "feat: enhance UI with modern patterns"
git push origin main
```

**Phase 3: Post-Integration Validation**

**Complete System Check:**
```bash
# 1. Clean environment
rm -rf node_modules package-lock.json
npm install

# 2. Type safety
npx tsc --noEmit
# Expected: 0 errors

# 3. Linting
npm run lint
# Expected: 0 errors, 0 warnings

# 4. Unit tests
npm test -- --coverage
# Expected: All pass, coverage â‰¥ 80%

# 5. Integration tests
npm run test:integration
# Expected: All pass

# 6. E2E tests
npm run test:e2e
# Expected: All pass

# 7. Build verification
npm run build
# Expected: Build successful

# 8. Visual regression (optional)
npm run test:visual
# Expected: No unexpected UI changes

# 9. Performance check
npm run test:performance
# Expected: No significant regressions
```

**Rollback Plan:**
```bash
# If integration fails and can't be fixed quickly:

# 1. Identify the problematic merge
git log --oneline --graph --all | head -20

# 2. Revert the merge commit (preserves history)
git revert -m 1 <merge-commit-hash>

# 3. Push revert
git push origin main

# 4. Create hotfix branch to address issues
git checkout -b hotfix/integration-issues
# Fix the problems
# Re-test thoroughly
# Create new PR for review
```

**Integration Health Dashboard:**
```bash
# Create a script to check integration health
# scripts/integration-health.sh

#!/bin/bash
echo "=== Integration Health Check ==="
echo ""

echo "ğŸ“¦ Dependencies"
npm list --depth=0 2>&1 | grep -E "UNMET|missing" && echo "âŒ FAIL" || echo "âœ… PASS"
echo ""

echo "ğŸ” TypeScript"
npx tsc --noEmit >/dev/null 2>&1 && echo "âœ… PASS (0 errors)" || echo "âŒ FAIL"
echo ""

echo "ğŸ“ ESLint"
npm run lint >/dev/null 2>&1 && echo "âœ… PASS" || echo "âŒ FAIL"
echo ""

echo "ğŸ§ª Tests"
npm test -- --passWithNoTests --silent >/dev/null 2>&1 && echo "âœ… PASS" || echo "âŒ FAIL"
echo ""

echo "ğŸ—ï¸ Build"
npm run build >/dev/null 2>&1 && echo "âœ… PASS" || echo "âŒ FAIL"
echo ""

echo "ğŸ¯ E2E"
npm run test:e2e >/dev/null 2>&1 && echo "âœ… PASS" || echo "âŒ FAIL"
echo ""

# Exit with error if any check failed
```

**Integration Checklist:**
- [ ] ã™ã¹ã¦ã®ãƒ–ãƒ©ãƒ³ãƒãŒæœ€æ–°ã® main ã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ã¦ã„ã‚‹
- [ ] ä¾å­˜é–¢ä¿‚ã®é †åºã§çµ±åˆã—ã¦ã„ã‚‹
- [ ] å„ãƒãƒ¼ã‚¸å¾Œã«å®Œå…¨ãªãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã‚’å®Ÿè¡Œ
- [ ] CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒã™ã¹ã¦ãƒ‘ã‚¹ã—ã¦ã„ã‚‹
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å›å¸°ãŒãªã„
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒæ›´æ–°ã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨ˆç”»ãŒæº–å‚™ã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã«çµ±åˆå®Œäº†ã‚’é€šçŸ¥æ¸ˆã¿

## âš ï¸ ç¦æ­¢äº‹é …
- `any` å‹ã®æ”¾ç½®ã€‚
- è­¦å‘Šï¼ˆWarningï¼‰ã‚’ç„¡è¦–ã—ãŸãƒãƒ¼ã‚¸ã€‚
- ã‚µãƒ¼ãƒãƒ¼/ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå¢ƒç•Œã‚’æ„è­˜ã—ãªã„ `'use client'` ã®æ¿«ç”¨ã€‚

## âœ… Verification Checklist (æ¤œè¨¼ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ)

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå®‰å®šåŒ–ä½œæ¥­ã‚’å®Œäº†ã™ã‚‹å‰ã«ã€ä»¥ä¸‹ã‚’**é †ç•ªã«**ç¢ºèªã—ã¦ãã ã•ã„ã€‚

### Phase 1: åŸºæœ¬æ¤œè¨¼ (Basic Validation)
ã“ã‚Œã‚‰ã¯ã™ã¹ã¦ **MUST PASS** ã§ã™ã€‚1ã¤ã§ã‚‚å¤±æ•—ã—ãŸã‚‰æ¬¡ã«é€²ã¾ãªã„ã§ãã ã•ã„ã€‚

```bash
# å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰
cd trading-platform
./scripts/basic-validation.sh
```

- [ ] **ä¾å­˜é–¢ä¿‚ã®æ•´åˆæ€§**
  ```bash
  npm install
  npm list --depth=0 2>&1 | grep -E "UNMET|missing"
  ```
  **Expected:** å‡ºåŠ›ãªã—ï¼ˆã™ã¹ã¦ã®ä¾å­˜é–¢ä¿‚ãŒè§£æ±ºæ¸ˆã¿ï¼‰
  **If fails:** `npm install` ã‚’å†å®Ÿè¡Œã€‚ãã‚Œã§ã‚‚å¤±æ•—ãªã‚‰ `package-lock.json` ã‚’å‰Šé™¤ã—ã¦ `npm install`

- [ ] **TypeScript å‹ãƒã‚§ãƒƒã‚¯**
  ```bash
  npx tsc --noEmit
  ```
  **Expected:** `Found 0 errors.`
  **If fails:** ã‚¨ãƒ©ãƒ¼ç®‡æ‰€ã‚’ä¿®æ­£ã€‚`any` å‹ã¯çµ¶å¯¾ã«ä½¿ã‚ãªã„

- [ ] **ESLint ãƒã‚§ãƒƒã‚¯**
  ```bash
  npm run lint
  ```
  **Expected:** `âœ“ No ESLint errors or warnings`
  **If fails:** `npm run lint:fix` ã§è‡ªå‹•ä¿®æ­£å¯èƒ½ãªã‚‚ã®ã‚’ä¿®æ­£ã€‚æ®‹ã‚Šã¯æ‰‹å‹•ä¿®æ­£

- [ ] **ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ**
  ```bash
  npm test -- --passWithNoTests --coverage
  ```
  **Expected:** 
  - `Tests: X passed, 0 failed`
  - `Coverage: â‰¥ 80% statements, branches, functions, lines`
  **If fails:** å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã‚’ä¿®æ­£ã€‚æ–°ã—ã„ã‚³ãƒ¼ãƒ‰ã«ã¯å¿…ãšãƒ†ã‚¹ãƒˆã‚’è¿½åŠ 

- [ ] **ãƒ“ãƒ«ãƒ‰ã®æˆåŠŸ**
  ```bash
  npm run build
  ```
  **Expected:** `Build completed successfully`
  **If fails:** ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ã‚’ä¿®æ­£ã€‚é€šå¸¸ã¯å‹ã‚¨ãƒ©ãƒ¼ã‹ã‚¤ãƒ³ãƒãƒ¼ãƒˆå•é¡Œ

### Phase 2: ãƒãƒ¼ã‚¸å¾Œã®å“è³ªãƒã‚§ãƒƒã‚¯ (Post-Merge Quality)

- [ ] **æ©Ÿèƒ½ã®ãƒ‡ã‚°ãƒ¬ãƒ¼ãƒ‰ãŒãªã„**
  ```bash
  # ä¸»è¦æ©Ÿèƒ½ã®æ‰‹å‹•ãƒ†ã‚¹ãƒˆ
  npm run dev
  # ãƒ–ãƒ©ã‚¦ã‚¶ã§ä»¥ä¸‹ã‚’ç¢ºèª:
  # 1. ãƒ­ã‚°ã‚¤ãƒ³/ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
  # 2. æ ªä¾¡ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã¨è¡¨ç¤º
  # 3. ãƒãƒ£ãƒ¼ãƒˆã®æç”»
  # 4. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°
  ```
  **Checklist:**
  - [ ] æ—¢å­˜ã®ç”»é¢ãŒã™ã¹ã¦è¡¨ç¤ºã•ã‚Œã‚‹
  - [ ] æ—¢å­˜ã®æ©Ÿèƒ½ãŒã™ã¹ã¦å‹•ä½œã™ã‚‹
  - [ ] ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«æ–°ã—ã„ã‚¨ãƒ©ãƒ¼ãŒãªã„
  - [ ] ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæ­£å¸¸

- [ ] **æ–°ã—ã„è­¦å‘ŠãŒè¿½åŠ ã•ã‚Œã¦ã„ãªã„**
  ```bash
  # ãƒãƒ¼ã‚¸å‰ã®è­¦å‘Šæ•°ã‚’è¨˜éŒ²
  git checkout main
  npm run lint 2>&1 | grep "warning" | wc -l
  
  # ãƒãƒ¼ã‚¸å¾Œã®è­¦å‘Šæ•°ã‚’ç¢ºèª
  git checkout feature/my-branch
  npm run lint 2>&1 | grep "warning" | wc -l
  ```
  **Expected:** è­¦å‘Šæ•°ãŒå¢—åŠ ã—ã¦ã„ãªã„ï¼ˆæ¸›å°‘ã¯æ­“è¿ï¼‰

- [ ] **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ãŒç¶­æŒã¾ãŸã¯æ”¹å–„**
  ```bash
  npm test -- --coverage --silent
  grep "Statements" coverage/coverage-summary.json
  ```
  **Expected:** ã‚«ãƒãƒ¬ãƒƒã‚¸ãŒå‰å›ã‚ˆã‚Šä½ä¸‹ã—ã¦ã„ãªã„

- [ ] **ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®çµ±ä¸€**
  ```bash
  # npm ã®ã¿ã‚’ä½¿ç”¨ï¼ˆpnpm-lock.yaml ã‚„ yarn.lock ãŒã‚ã£ã¦ã¯ã„ã‘ãªã„ï¼‰
  ls -la | grep -E "pnpm-lock|yarn.lock"
  ```
  **Expected:** ä½•ã‚‚è¦‹ã¤ã‹ã‚‰ãªã„
  **If fails:** `rm pnpm-lock.yaml yarn.lock && npm install`

### Phase 3: ãƒ¢ãƒ€ãƒ³åŒ–ã®ç¢ºèª (Modernization Validation)

- [ ] **TanStack Query ãŒé©åˆ‡ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹**ï¼ˆè©²å½“ã™ã‚‹å ´åˆï¼‰
  ```bash
  # useQuery/useMutation ã®ä½¿ç”¨ç®‡æ‰€ã‚’ç¢ºèª
  grep -r "useQuery\|useMutation" app/ --include="*.tsx" --include="*.ts"
  
  # å¤ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆuseEffect + fetchï¼‰ãŒæ®‹ã£ã¦ã„ãªã„ã‹
  grep -r "useEffect.*fetch" app/components/ --include="*.tsx"
  ```
  **Expected:** 
  - ãƒ‡ãƒ¼ã‚¿å–å¾—ã« `useQuery` ã‚’ä½¿ç”¨
  - ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã« `useMutation` ã‚’ä½¿ç”¨
  - `useEffect` ã§ã®æ‰‹å‹• fetch ãŒå­˜åœ¨ã—ãªã„

- [ ] **Zod ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãŒé©ç”¨ã•ã‚Œã¦ã„ã‚‹**ï¼ˆè©²å½“ã™ã‚‹å ´åˆï¼‰
  ```bash
  # Zod ã‚¹ã‚­ãƒ¼ãƒã®å®šç¾©ã‚’ç¢ºèª
  find app/lib/schemas -name "*.ts" -type f
  
  # API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ã®ä½¿ç”¨ã‚’ç¢ºèª
  grep -r "\.parse\|\.safeParse" app/lib/api/ --include="*.ts"
  ```
  **Expected:**
  - ã™ã¹ã¦ã®å¤–éƒ¨ãƒ‡ãƒ¼ã‚¿ã« Zod ã‚¹ã‚­ãƒ¼ãƒãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹
  - API ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã§ `.parse()` ãŒå‘¼ã°ã‚Œã¦ã„ã‚‹

- [ ] **React 19 ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«æº–æ‹ **
  ```bash
  # use client ã®ä½¿ç”¨ç®‡æ‰€ã‚’ç¢ºèª
  grep -r "'use client'" app/ --include="*.tsx" --include="*.ts"
  
  # useEffect ã®ä¾å­˜é…åˆ—ã‚’ç¢ºèª
  grep -A 2 "useEffect" app/components/ --include="*.tsx" | grep -E "\[\]|\.current"
  ```
  **Expected:**
  - `'use client'` ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ©Ÿèƒ½ã‚’ä½¿ã†ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã¿
  - useEffect ã®ä¾å­˜é…åˆ—ã« `ref.current` ãŒãªã„
  - ä¸è¦ãª useEffect ãŒå­˜åœ¨ã—ãªã„

- [ ] **ã‚µãƒ¼ãƒãƒ¼/ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå¢ƒç•ŒãŒé©åˆ‡**
  ```bash
  # ã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå°‚ç”¨æ©Ÿèƒ½ã‚’ä½¿ã£ã¦ã„ãªã„ã‹
  grep -r "useState\|useEffect\|useContext" app/ --include="*.tsx" | grep -v "use client"
  ```
  **Expected:** å‡ºåŠ›ãªã—ï¼ˆã™ã¹ã¦ã®ãƒ•ãƒƒã‚¯ãŒ 'use client' ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ï¼‰

### Phase 4: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ (Documentation)

- [ ] **é‡è¦ãªå¤‰æ›´ã«ã‚³ãƒ¡ãƒ³ãƒˆãŒã‚ã‚‹**
  ```bash
  # è¤‡é›‘ãªãƒ­ã‚¸ãƒƒã‚¯ã«ã‚³ãƒ¡ãƒ³ãƒˆãŒã‚ã‚‹ã‹ç¢ºèª
  git diff main -- app/lib/ | grep -E "^\+.*\/\/"
  ```
  **Checklist:**
  - [ ] è¤‡é›‘ãªã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«èª¬æ˜ã‚³ãƒ¡ãƒ³ãƒˆ
  - [ ] å›é¿ç­–ï¼ˆworkaroundï¼‰ã«ç†ç”±ã®ã‚³ãƒ¡ãƒ³ãƒˆ
  - [ ] ãƒ‘ãƒ–ãƒªãƒƒã‚¯APIã« JSDoc ã‚³ãƒ¡ãƒ³ãƒˆ

- [ ] **ç ´å£Šçš„å¤‰æ›´ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°**
  ```bash
  # ç’°å¢ƒå¤‰æ•°ã®å¤‰æ›´ã‚’ç¢ºèª
  git diff main -- .env.example
  
  # README ã®æ›´æ–°ã‚’ç¢ºèª
  git diff main -- README.md
  ```
  **Required updates if:**
  - API ã®ç ´å£Šçš„å¤‰æ›´ â†’ `docs/API.md` æ›´æ–°
  - ç’°å¢ƒå¤‰æ•°ã®è¿½åŠ /å‰Šé™¤ â†’ `.env.example` æ›´æ–°
  - ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †ã®å¤‰æ›´ â†’ `README.md` æ›´æ–°

- [ ] **ç’°å¢ƒå¤‰æ•°ã®åŒæœŸ**
  ```bash
  # .env.example ã«å¿…è¦ãªå¤‰æ•°ãŒã™ã¹ã¦ã‚ã‚‹ã‹
  grep -o "process\.env\.[A-Z_]*" app/ -r --include="*.ts" --include="*.tsx" | \
    sed 's/process\.env\.//' | sort -u
  
  # .env.example ã®å†…å®¹ã¨æ¯”è¼ƒ
  grep "^[A-Z_]*=" .env.example | cut -d= -f1 | sort
  ```
  **Expected:** ä¸¡æ–¹ã®ãƒªã‚¹ãƒˆãŒä¸€è‡´ï¼ˆãƒ†ã‚¹ãƒˆç”¨ã®å¤‰æ•°ã‚’é™¤ãï¼‰

### Phase 5: æœ€çµ‚æ¤œè¨¼ (Final Verification)

- [ ] **E2E ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ**
  ```bash
  npm run test:e2e
  ```
  **Expected:** ã™ã¹ã¦ã® E2E ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹
  **If fails:** ãƒ†ã‚¹ãƒˆãŒç’°å¢ƒä¾å­˜ã®å ´åˆã€CI ãƒ­ã‚°ã§ç¢ºèª

- [ ] **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å›å¸°ãªã—**
  ```bash
  # ãƒ“ãƒ«ãƒ‰ã‚µã‚¤ã‚ºã®ç¢ºèª
  npm run build
  ls -lh .next/static/chunks/pages/ | awk '{print $5, $9}' | sort -h
  
  # Lighthouse ã‚¹ã‚³ã‚¢ã®ç¢ºèªï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  npm run lighthouse
  ```
  **Expected:**
  - ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºãŒå¤§å¹…ã«å¢—åŠ ã—ã¦ã„ãªã„ï¼ˆ+10% ä»¥å†…ï¼‰
  - Lighthouse ã‚¹ã‚³ã‚¢ â‰¥ 90 (Performance, Accessibility, Best Practices)

- [ ] **CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ç¢ºèª**
  ```bash
  # ãƒ­ãƒ¼ã‚«ãƒ«ã§ CI ã¨åŒã˜ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œ
  npm run ci:check  # package.json ã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹å ´åˆ
  
  # ã¾ãŸã¯æ‰‹å‹•ã§
  npm install && npm test && npm run lint && npm run build
  ```
  **Expected:** ã™ã¹ã¦ã®ã‚³ãƒãƒ³ãƒ‰ãŒæˆåŠŸ

- [ ] **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³**
  ```bash
  npm audit
  npm audit --production
  ```
  **Expected:** 
  - `0 vulnerabilities` ã¾ãŸã¯
  - æ—¢çŸ¥ã® false positive ã®ã¿
  **If fails:** `npm audit fix` ã§ä¿®æ­£å¯èƒ½ãªã‚‚ã®ã‚’ä¿®æ­£

### æ¤œè¨¼å®Œäº†å¾Œã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ (Post-Verification Actions)

ã™ã¹ã¦ã®ãƒã‚§ãƒƒã‚¯ãŒãƒ‘ã‚¹ã—ãŸã‚‰:

1. **å¤‰æ›´ã‚’ main ã«ãƒãƒ¼ã‚¸**
   ```bash
   git checkout main
   git merge --no-ff feature/my-branch -m "feat: description of changes"
   git push origin main
   ```

2. **ã‚¿ã‚°ã‚’ä»˜ã‘ã‚‹**ï¼ˆãƒ¡ã‚¸ãƒ£ãƒ¼ãªå¤‰æ›´ã®å ´åˆï¼‰
   ```bash
   git tag -a v1.2.0 -m "Release v1.2.0: Project stabilization"
   git push origin v1.2.0
   ```

3. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ›´æ–°**
   - CHANGELOG.md ã«å¤‰æ›´å†…å®¹ã‚’è¨˜éŒ²
   - PR ã«æ¤œè¨¼çµæœã‚’æ·»ä»˜
   - Slack/Teams ã§ãƒãƒ¼ãƒ ã«é€šçŸ¥

4. **ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**
   ```bash
   # ãƒãƒ¼ã‚¸æ¸ˆã¿ãƒ–ãƒ©ãƒ³ãƒã‚’å‰Šé™¤
   git branch -d feature/my-branch
   git push origin --delete feature/my-branch
   ```

### ã‚¯ã‚¤ãƒƒã‚¯ãƒã‚§ãƒƒã‚¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

ã™ã¹ã¦ã®æ¤œè¨¼ã‚’ä¸€åº¦ã«å®Ÿè¡Œã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ:

```bash
#!/bin/bash
# scripts/verify-all.sh

set -e  # ã‚¨ãƒ©ãƒ¼ã§åœæ­¢

echo "ğŸ” Phase 1: Basic Validation"
npm install
npx tsc --noEmit
npm run lint
npm test -- --coverage
npm run build

echo "âœ… Phase 1 passed"

echo "ğŸ” Phase 2: Post-Merge Quality"
# ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒã‚§ãƒƒã‚¯
COVERAGE=$(npm test -- --coverage --silent | grep "All files" | awk '{print $10}' | sed 's/%//')
if [ "$COVERAGE" -lt 80 ]; then
  echo "âŒ Coverage too low: $COVERAGE%"
  exit 1
fi

echo "âœ… Phase 2 passed"

echo "ğŸ” Phase 3: Modernization"
# å¤ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒæ®‹ã£ã¦ã„ãªã„ã‹
OLD_PATTERNS=$(grep -r "useEffect.*fetch" app/components/ --include="*.tsx" | wc -l)
if [ "$OLD_PATTERNS" -gt 0 ]; then
  echo "âš ï¸  Warning: $OLD_PATTERNS old useEffect+fetch patterns found"
fi

echo "âœ… Phase 3 passed"

echo "ğŸ” Phase 4: Documentation"
# .env.example ãŒæœ€æ–°ã‹
git diff --quiet .env.example || echo "âš ï¸  .env.example has uncommitted changes"

echo "âœ… Phase 4 passed"

echo "ğŸ” Phase 5: Final Verification"
npm run test:e2e
npm audit --production

echo "âœ… All phases passed! Ready to merge."
```

## ğŸ”§ Common Troubleshooting (ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºç­–)

### Issue 1: ãƒ†ã‚¹ãƒˆãŒç„¡é™ãƒ«ãƒ¼ãƒ—ã™ã‚‹
**ç—‡çŠ¶:**
```bash
$ npm test
Tests are running... (never completes)
CPU usage: 100%
```

**åŸå› :** 
- useEffect ã®ä¾å­˜é…åˆ—ãŒä¸é©åˆ‡
- TanStack Query ã®è¨­å®šãƒŸã‚¹ï¼ˆrefetchInterval ãŒ 0ï¼‰
- ãƒ¢ãƒƒã‚¯ãŒç„¡é™ã« Promise ã‚’è¿”ã™

**è¨ºæ–­:**
```typescript
// Bad: Missing dependencies
useEffect(() => {
  fetchData(userId);
}, []); // userId ã®å¤‰æ›´ãŒæ¤œçŸ¥ã•ã‚Œãªã„

// Bad: Object in dependency array
useEffect(() => {
  fetchData(config);
}, [config]); // config ã¯æ¯å›æ–°ã—ã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ â†’ ç„¡é™ãƒ«ãƒ¼ãƒ—
```

**Solution:**
```typescript
// Good: Proper primitive dependencies
useEffect(() => {
  fetchData(userId);
}, [userId]);

// Better: Use TanStack Query (no useEffect needed)
const { data } = useQuery({
  queryKey: ['user', userId],
  queryFn: () => fetchUser(userId),
  staleTime: 30000, // 30ç§’ã‚­ãƒ£ãƒƒã‚·ãƒ¥
});
```

**Verification:**
```bash
# ãƒ†ã‚¹ãƒˆã‚’ --detectOpenHandles ã§å®Ÿè¡Œ
npm test -- --detectOpenHandles

# ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’è¨­å®šã—ã¦å¼·åˆ¶çµ‚äº†
npm test -- --testTimeout=5000
```

---

### Issue 2: Zod ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãŒæœ¬ç•ªã§ç™ºç”Ÿ
**ç—‡çŠ¶:**
```
ZodError: [
  {
    "code": "invalid_type",
    "expected": "number",
    "received": "string",
    "path": ["price"]
  }
]
```

**åŸå› :** 
- API ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å½¢å¼ãŒç’°å¢ƒã§ç•°ãªã‚‹
- å¤ã„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ‡ãƒ¼ã‚¿ãŒæ®‹ã£ã¦ã„ã‚‹
- API ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ä¸ä¸€è‡´

**è¨ºæ–­:**
```typescript
// API ãŒè¿”ã™å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¨˜éŒ²
try {
  return DataSchema.parse(json);
} catch (error) {
  if (error instanceof z.ZodError) {
    console.error('Validation failed:', error.errors);
    console.error('Received data:', JSON.stringify(json, null, 2));
    console.error('Expected schema:', DataSchema);
  }
  throw error;
}
```

**Solution:**
```typescript
// 1. ã‚¹ã‚­ãƒ¼ãƒã‚’å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã«åˆã‚ã›ã‚‹
const DataSchema = z.object({
  price: z.union([z.number(), z.string()]).transform(val => 
    typeof val === 'string' ? parseFloat(val) : val
  ),
});

// 2. strict ãƒ¢ãƒ¼ãƒ‰ã§æœªçŸ¥ã®ã‚­ãƒ¼ã‚’æ‹’å¦
const DataSchema = z.object({
  id: z.string(),
  value: z.number(),
}).strict(); // å®šç¾©å¤–ã®ã‚­ãƒ¼ãŒã‚ã‚Œã°ã‚¨ãƒ©ãƒ¼

// 3. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®š
const DataSchema = z.object({
  price: z.number().default(0),
  change: z.number().optional(),
});

// 4. è©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
const DataSchema = z.object({
  price: z.number({
    required_error: "Price is required",
    invalid_type_error: "Price must be a number",
  }),
});
```

**Verification:**
```bash
# ã‚¹ã‚­ãƒ¼ãƒã®ãƒ†ã‚¹ãƒˆã‚’ä½œæˆ
npm test -- schemas/stock.test.ts

# å®Ÿéš›ã® API ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã§ãƒ†ã‚¹ãƒˆ
curl https://api.example.com/stocks/AAPL | jq . > test-data.json
node -e "const schema = require('./app/lib/schemas/stock').StockDataSchema; \
         const data = require('./test-data.json'); \
         console.log(schema.parse(data));"
```

---

### Issue 3: `'use client'` ã‚’è¿½åŠ ã—ã¦ã‚‚ã‚¨ãƒ©ãƒ¼ãŒè§£æ±ºã—ãªã„
**ç—‡çŠ¶:**
```
Error: useState only works in Client Components
```

**åŸå› :** 
- ã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå°‚ç”¨æ©Ÿèƒ½ã‚’ä½¿ç”¨
- `'use client'` ã®ä½ç½®ãŒé–“é•ã£ã¦ã„ã‚‹
- è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

**è¨ºæ–­:**
```typescript
// âŒ Bad: Server component using client hooks
export default function Page() {
  const [state, setState] = useState(0); // Error!
  return <div>{state}</div>;
}

// âŒ Bad: 'use client' ãŒ import ã®å¾Œ
import { useState } from 'react';
'use client'; // Too late!

// âŒ Bad: Server component importing client without boundary
// app/page.tsx (Server Component)
import { Counter } from './Counter'; // Counter uses useState
export default function Page() {
  return <Counter />;
}
```

**Solution:**
```typescript
// âœ… Good: Separate client component
// app/components/Counter.tsx
'use client';

import { useState } from 'react';

export function Counter() {
  const [state, setState] = useState(0);
  return (
    <div>
      <p>Count: {state}</p>
      <button onClick={() => setState(state + 1)}>Increment</button>
    </div>
  );
}

// âœ… Good: Server component imports client component
// app/page.tsx
import { Counter } from '@/components/Counter';

export default function Page() {
  // Server component - no hooks
  const data = await fetchData(); // Server-side data fetching
  
  return (
    <div>
      <h1>Server Component</h1>
      <Counter /> {/* Client component boundary */}
    </div>
  );
}
```

**Architecture Pattern:**
```
app/
â”œâ”€â”€ page.tsx                 (Server Component)
â”‚   â””â”€â”€ imports ClientWrapper
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ClientWrapper.tsx    ('use client' - boundary)
â”‚   â”‚   â””â”€â”€ imports Counter
â”‚   â””â”€â”€ Counter.tsx          (Client Component)
```

**Verification:**
```bash
# ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç¢ºèª
grep -r "'use client'" app/ --include="*.tsx"

# useState/useEffect ãŒ Server Component ã«ãªã„ã‹ç¢ºèª
grep -r "useState\|useEffect" app/page.tsx app/layout.tsx
```

---

### Issue 4: ãƒãƒ¼ã‚¸å¾Œã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒç«¶åˆ
**ç—‡çŠ¶:**
```bash
$ npm install
npm ERR! Found: react@19.0.0
npm ERR! Could not resolve dependency:
npm ERR! peer react@"^18.0.0" from @some/package@1.0.0
```

**åŸå› :** 
- è¤‡æ•°ã®ãƒ–ãƒ©ãƒ³ãƒã§ç•°ãªã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
- peer dependency ã®ä¸ä¸€è‡´
- npm vs pnpm vs yarn ã®æ··åœ¨

**è¨ºæ–­:**
```bash
# ç«¶åˆã—ã¦ã„ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ç‰¹å®š
npm list react
npm list react-dom

# ãƒ­ãƒƒã‚¯ãƒ•ã‚¡ã‚¤ãƒ«ã®é‡è¤‡ã‚’ç¢ºèª
ls -la | grep -E "package-lock|pnpm-lock|yarn.lock"
```

**Solution:**
```bash
# 1. ã‚¯ãƒªãƒ¼ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
rm -rf node_modules package-lock.json pnpm-lock.yaml yarn.lock

# 2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¨™æº–ï¼ˆnpmï¼‰ã§å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install

# 3. ç‰¹å®šãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’æ›´æ–°
npm install react@latest react-dom@latest

# 4. peer dependency ã®è­¦å‘Šã‚’è§£æ±º
npm install --legacy-peer-deps  # ä¸€æ™‚çš„ãªå›é¿ç­–

# 5. ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®å›ºå®š
npm install react@19.0.0 --save-exact

# 6. package.json ã®æ•´åˆæ€§ç¢ºèª
cat package.json | jq '.dependencies'

# 7. ãƒ­ãƒƒã‚¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒŸãƒƒãƒˆ
git add package-lock.json
git commit -m "chore: resolve package version conflicts"
```

**Prevention:**
```json
// package.json ã§ç¯„å›²ã‚’åˆ¶é™
{
  "engines": {
    "node": ">=18.0.0 <20.0.0",
    "npm": ">=9.0.0"
  },
  "packageManager": "npm@9.8.1"
}
```

**Verification:**
```bash
# ã™ã¹ã¦ã®ä¾å­˜é–¢ä¿‚ãŒè§£æ±ºã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
npm list --depth=0

# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å•é¡ŒãŒãªã„ã‹ç¢ºèª
npm audit

# é‡è¤‡ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒãªã„ã‹ç¢ºèª
npm dedupe
npm list --all | grep -E "deduped"
```

---

### Issue 5: ãƒ†ã‚¹ãƒˆã§ async/await ãŒæ­£ã—ãå‹•ä½œã—ãªã„
**ç—‡çŠ¶:**
```typescript
test('fetches data', async () => {
  const data = await fetchData();
  expect(data).toBeDefined(); // Passes but data is undefined
});
```

**åŸå› :**
- Promise ãŒ reject ã•ã‚Œã¦ã„ã‚‹ãŒã‚­ãƒ£ãƒƒãƒã•ã‚Œã¦ã„ãªã„
- ãƒ¢ãƒƒã‚¯ãŒåŒæœŸçš„ã«è¿”ã—ã¦ã„ã‚‹
- waitFor ã‚’ä½¿ã£ã¦ã„ãªã„

**Solution:**
```typescript
// âœ… Good: Proper async testing
test('fetches data correctly', async () => {
  // 1. ãƒ¢ãƒƒã‚¯ãŒ Promise ã‚’è¿”ã™ã“ã¨ã‚’ç¢ºèª
  jest.spyOn(api, 'fetchData').mockResolvedValue({ id: 1, name: 'Test' });
  
  // 2. await ã§çµæœã‚’å¾…ã¤
  const data = await fetchData();
  
  // 3. æ¤œè¨¼
  expect(data).toEqual({ id: 1, name: 'Test' });
});

// âœ… Good: Testing React async updates
test('displays fetched data', async () => {
  render(<DataComponent />);
  
  // findBy* ã¯è¦ç´ ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¾ã§å¾…æ©Ÿ
  const element = await screen.findByText('Test Data');
  expect(element).toBeInTheDocument();
  
  // ã¾ãŸã¯ waitFor ã‚’ä½¿ç”¨
  await waitFor(() => {
    expect(screen.getByText('Test Data')).toBeInTheDocument();
  });
});

// âœ… Good: Testing error cases
test('handles fetch error', async () => {
  jest.spyOn(api, 'fetchData').mockRejectedValue(new Error('Network error'));
  
  await expect(fetchData()).rejects.toThrow('Network error');
});
```

---

### Issue 6: E2E ãƒ†ã‚¹ãƒˆãŒ CI ã§å¤±æ•—ã™ã‚‹ãŒãƒ­ãƒ¼ã‚«ãƒ«ã§ã¯æˆåŠŸ
**ç—‡çŠ¶:**
```
CI: âœ— Login test - Timeout waiting for element
Local: âœ“ Login test
```

**åŸå› :**
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãŒçŸ­ã™ãã‚‹
- CI ç’°å¢ƒã® CPU/ãƒ¡ãƒ¢ãƒªãŒé…ã„
- ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹ãƒ¢ãƒ¼ãƒ‰ã§ã®æç”»ã®é•ã„
- ç’°å¢ƒå¤‰æ•°ã®ä¸ä¸€è‡´

**Solution:**
```typescript
// playwright.config.ts
export default defineConfig({
  timeout: 30000, // ãƒ­ãƒ¼ã‚«ãƒ«: 10s, CI: 30s
  expect: {
    timeout: 10000,
  },
  retries: process.env.CI ? 2 : 0, // CI ã§ 2 å›ãƒªãƒˆãƒ©ã‚¤
  workers: process.env.CI ? 1 : undefined, // CI ã§ã¯ä¸¦åˆ—å®Ÿè¡Œã‚’åˆ¶é™
  use: {
    baseURL: process.env.CI 
      ? 'http://localhost:3000' 
      : 'http://localhost:3000',
    screenshot: 'only-on-failure',
    trace: 'retain-on-failure',
    video: process.env.CI ? 'on' : 'off',
  },
});
```

**Debugging:**
```bash
# CI ã¨åŒã˜ç’°å¢ƒã§ãƒ­ãƒ¼ã‚«ãƒ«å®Ÿè¡Œ
CI=true npm run test:e2e

# ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹ãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œ
npm run test:e2e:headed=false

# ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã¨ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’æœ‰åŠ¹åŒ–
npm run test:e2e -- --trace on --screenshot on

# CI ãƒ­ã‚°ã‹ã‚‰ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
playwright show-trace trace.zip
```

---

### Issue 7: ãƒ“ãƒ«ãƒ‰ã¯æˆåŠŸã™ã‚‹ãŒå®Ÿè¡Œæ™‚ã‚¨ãƒ©ãƒ¼
**ç—‡çŠ¶:**
```bash
$ npm run build
âœ“ Build successful

$ npm start
Error: Cannot find module '@/lib/utils'
```

**åŸå› :**
- ã‚±ãƒ¼ã‚¹ sensitive ãªå•é¡Œï¼ˆmacOS vs Linuxï¼‰
- ãƒ‘ã‚¹ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã®è¨­å®šãƒŸã‚¹
- å‹•çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆã®å•é¡Œ

**Solution:**
```typescript
// tsconfig.json ã®ãƒ‘ã‚¹ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã‚’ç¢ºèª
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["./app/*"]
    }
  }
}

// next.config.js ã§ã‚‚åŒæ§˜ã«è¨­å®š
module.exports = {
  webpack: (config) => {
    config.resolve.alias = {
      ...config.resolve.alias,
      '@': path.resolve(__dirname, 'app'),
    };
    return config;
  },
};
```

**Verification:**
```bash
# ã‚±ãƒ¼ã‚¹sensitiveãªå•é¡Œã‚’æ¤œå‡º
find app/ -name "*.ts" -o -name "*.tsx" | while read file; do
  grep -i "from.*utils" "$file" && echo "Check case: $file"
done

# ãƒ“ãƒ«ãƒ‰å¾Œã®å‡ºåŠ›ã‚’ç¢ºèª
npm run build
ls -la .next/server/app/

# ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ãƒ¢ãƒ¼ãƒ‰ã§èµ·å‹•
NODE_ENV=production npm start
```

## ğŸ“š References

- **TanStack Query**: https://tanstack.com/query/latest
- **Zod**: https://zod.dev
- **React 19 Guide**: https://react.dev/blog/2024/04/25/react-19
- **Next.js App Router**: https://nextjs.org/docs/app
- **Testing Library**: https://testing-library.com/docs/react-testing-library/intro

## ğŸ¯ Success Criteria (æˆåŠŸåŸºæº–)

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå®‰å®šåŒ–ãŒ**æˆåŠŸã—ãŸã¨åˆ¤æ–­ã™ã‚‹å®šé‡çš„ãƒ»å®šæ€§çš„åŸºæº–**ã€‚

### âœ… Zero Errors (ã‚¨ãƒ©ãƒ¼ã‚¼ãƒ­)

**å®šé‡åŸºæº–:**
```bash
# 1. TypeScript
npx tsc --noEmit
# Expected: "Found 0 errors. Watching for file changes."

# 2. ESLint
npm run lint
# Expected: "âœ“ No ESLint errors or warnings"

# 3. Tests
npm test
# Expected: "Tests: X passed, 0 failed, 0 skipped"
# Expected: "Snapshots: X passed"
```

**åˆæ ¼æ¡ä»¶:**
- TypeScript ã‚¨ãƒ©ãƒ¼: **0**
- ESLint ã‚¨ãƒ©ãƒ¼: **0**
- ESLint è­¦å‘Š: **0** ï¼ˆæ–°è¦è¿½åŠ ãªã—ï¼‰
- ãƒ†ã‚¹ãƒˆå¤±æ•—: **0**
- ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆä¸ä¸€è‡´: **0**

---

### âœ… No Regressions (æ©Ÿèƒ½ãƒ‡ã‚°ãƒ¬ãƒ¼ãƒ‰ãªã—)

**å®šæ€§åŸºæº–:**
ä»¥ä¸‹ã®ã™ã¹ã¦ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨:

**ã‚³ã‚¢æ©Ÿèƒ½:**
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ï¼ˆãƒ­ã‚°ã‚¤ãƒ³/ãƒ­ã‚°ã‚¢ã‚¦ãƒˆï¼‰
- [ ] æ ªä¾¡ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã¨è¡¨ç¤º
- [ ] ãƒãƒ£ãƒ¼ãƒˆã®æç”»ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°å«ã‚€ï¼‰
- [ ] äºˆæ¸¬æ©Ÿèƒ½ï¼ˆML ãƒ¢ãƒ‡ãƒ«ã®å®Ÿè¡Œï¼‰
- [ ] ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆæ©Ÿèƒ½
- [ ] ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªç®¡ç†

**UI/UX:**
- [ ] ã™ã¹ã¦ã®ãƒšãƒ¼ã‚¸ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ©Ÿèƒ½ã™ã‚‹
- [ ] ãƒ•ã‚©ãƒ¼ãƒ ã®é€ä¿¡ãŒæ­£å¸¸
- [ ] ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ãŒé©åˆ‡ã«è¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹

**ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹:**
```bash
# Lighthouse ã‚¹ã‚³ã‚¢ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
npm run lighthouse

# Expected:
# Performance: â‰¥ 90
# Accessibility: â‰¥ 90
# Best Practices: â‰¥ 90
# SEO: â‰¥ 90
```

**æ¤œè¨¼æ–¹æ³•:**
```bash
# 1. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
npm run dev

# 2. ãƒ–ãƒ©ã‚¦ã‚¶ã§ä¸»è¦ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ­ãƒ¼ã‚’ãƒ†ã‚¹ãƒˆ
# - ãƒ­ã‚°ã‚¤ãƒ³ â†’ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ â†’ æ ªä¾¡æ¤œç´¢ â†’ ãƒãƒ£ãƒ¼ãƒˆè¡¨ç¤º â†’ ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ

# 3. ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼ãŒãªã„ã“ã¨ã‚’ç¢ºèª
# - ãƒ–ãƒ©ã‚¦ã‚¶ DevTools ã® Console ã‚¿ãƒ–
# - Network ã‚¿ãƒ–ã§ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒãªã„ã‹ç¢ºèª

# 4. E2E ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
npm run test:e2e
```

---

### âœ… Improved Quality (å“è³ªå‘ä¸Š)

**å®šé‡åŸºæº–:**

1. **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ â‰¥ 80%**
```bash
npm test -- --coverage
# Expected:
# Statements   : 82.5% ( X/Y )
# Branches     : 80.1% ( X/Y )
# Functions    : 83.2% ( X/Y )
# Lines        : 82.8% ( X/Y )
```

2. **ã‚³ãƒ¼ãƒ‰å“è³ªã‚¹ã‚³ã‚¢**
```bash
# Cyclomatic Complexityï¼ˆå¾ªç’°çš„è¤‡é›‘åº¦ï¼‰
npx eslint app/ --ext .ts,.tsx --format json | \
  jq '[.[] | .messages[] | select(.ruleId == "complexity")] | length'
# Expected: 0 (è¤‡é›‘åº¦ 10 ä»¥ä¸Šã®é–¢æ•°ãªã—)

# é‡è¤‡ã‚³ãƒ¼ãƒ‰
npx jscpd app/ --threshold 5
# Expected: "No duplications found"
```

3. **Bundle Sizeï¼ˆãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºï¼‰**
```bash
npm run build
ls -lh .next/static/chunks/pages/*.js | awk '{print $5}'
# Expected: 
# - First Load JS: â‰¤ 200 KB
# - å€‹åˆ¥ãƒšãƒ¼ã‚¸: â‰¤ 50 KB
```

**ãƒãƒ¼ã‚¸å‰å¾Œã®æ¯”è¼ƒ:**
```bash
# Before merge
Total coverage: 78.5%
Bundle size: 187 KB
Lint warnings: 23

# After merge
Total coverage: 82.3% (+3.8%) âœ…
Bundle size: 192 KB (+5 KB) âœ…
Lint warnings: 0 (-23) âœ…
```

**åˆæ ¼æ¡ä»¶:**
- ã‚«ãƒãƒ¬ãƒƒã‚¸: ç¶­æŒã¾ãŸã¯å‘ä¸Š
- ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚º: +10% ä»¥å†…
- Lint è­¦å‘Š: æ¸›å°‘ã¾ãŸã¯åŒã˜

---

### âœ… Documentation Updated (ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°)

**å¿…é ˆæ›´æ–°é …ç›®:**

1. **ç’°å¢ƒå¤‰æ•°ã®å¤‰æ›´**
```bash
# .env.example ãŒæœ€æ–°ã‹ç¢ºèª
git diff main -- .env.example

# ã™ã¹ã¦ã®ç’°å¢ƒå¤‰æ•°ãŒæ–‡æ›¸åŒ–ã•ã‚Œã¦ã„ã‚‹ã‹
grep "^[A-Z_]*=" .env.example | wc -l
grep -r "process.env." app/ --include="*.ts" | \
  sed 's/.*process\.env\.\([A-Z_]*\).*/\1/' | sort -u | wc -l
# Expected: ä¸¡æ–¹ã®æ•°ãŒä¸€è‡´
```

2. **API ã®å¤‰æ›´**
```bash
# ç ´å£Šçš„å¤‰æ›´ãŒã‚ã‚Œã° CHANGELOG.md ã«è¨˜éŒ²
git diff main -- app/api/

# If changes exist:
# - Update docs/API.md
# - Add entry to CHANGELOG.md
# - Update OpenAPI schema (if applicable)
```

3. **README.md ã®æ›´æ–°**
```bash
# ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †ãŒå¤‰ã‚ã£ãŸå ´åˆ
git diff main -- README.md

# æ–°ã—ã„æ©Ÿèƒ½ãŒè¿½åŠ ã•ã‚ŒãŸå ´åˆ
# - README.md ã® Features ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ›´æ–°
# - ä½¿ç”¨ä¾‹ã‚’è¿½åŠ 
```

**ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ:**
- [ ] `.env.example` ãŒæœ€æ–°
- [ ] `CHANGELOG.md` ã«å¤‰æ›´ã‚’è¨˜éŒ²
- [ ] `README.md` ãŒæœ€æ–°ã®æ‰‹é †ã‚’åæ˜ 
- [ ] `docs/API.md` ãŒæœ€æ–°ï¼ˆAPI å¤‰æ›´ãŒã‚ã‚‹å ´åˆï¼‰
- [ ] è¤‡é›‘ãªãƒ­ã‚¸ãƒƒã‚¯ã«ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ 
- [ ] ãƒ‘ãƒ–ãƒªãƒƒã‚¯ API ã« JSDoc ã‚’è¿½åŠ 

---

### âœ… CI Passing (CI ãƒã‚§ãƒƒã‚¯æˆåŠŸ)

**GitHub Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼:**

ã™ã¹ã¦ã®ã‚¸ãƒ§ãƒ–ãŒç·‘ï¼ˆâœ…ï¼‰ã§ã‚ã‚‹ã“ã¨:

```yaml
# .github/workflows/ci.yml ã®å„ã‚¹ãƒ†ãƒƒãƒ—
âœ… Install dependencies
âœ… Type check (TypeScript)
âœ… Lint (ESLint)
âœ… Unit tests (Jest)
âœ… E2E tests (Playwright)
âœ… Build (Next.js)
âœ… Security audit (npm audit)
```

**æ¤œè¨¼æ–¹æ³•:**
```bash
# ãƒ­ãƒ¼ã‚«ãƒ«ã§ CI ã¨åŒã˜ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œ
npm ci
npx tsc --noEmit
npm run lint
npm test -- --coverage
npm run test:e2e
npm run build
npm audit --production
```

**CI ãƒ­ã‚°ã®ç¢ºèª:**
```bash
# GitHub CLI ã‚’ä½¿ç”¨
gh run list --branch feature/my-branch
gh run view <run-id> --log

# ã™ã¹ã¦ã®ã‚¹ãƒ†ãƒƒãƒ—ãŒæˆåŠŸã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
gh run view <run-id> --json conclusion -q '.jobs[].conclusion'
# Expected: ã™ã¹ã¦ "success"
```

---

### ğŸ“Š Success Report Template (æˆåŠŸãƒ¬ãƒãƒ¼ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ)

å®‰å®šåŒ–å®Œäº†æ™‚ã«ä»¥ä¸‹ã®å½¢å¼ã§ãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œæˆ:

```markdown
# Project Stabilization Success Report

## Date: 2024-01-15
## Branch: feature/project-stabilization
## Author: @username

---

## âœ… Quantitative Results

### Errors
- TypeScript: 0 errors (was: 15)
- ESLint: 0 errors, 0 warnings (was: 23 warnings)
- Tests: 247 passed, 0 failed (was: 198 passed, 49 failed)

### Quality Metrics
- Test Coverage: 82.5% (was: 67.3%, +15.2%)
- Build Time: 45s (was: 52s, -13%)
- Bundle Size: 192 KB (was: 187 KB, +2.7%)

### CI/CD
- All checks: âœ… Passing
- Deployment: âœ… Successful
- Performance: âœ… No regressions

---

## âœ… Qualitative Results

### Features Verified
- [x] User authentication
- [x] Stock data fetching
- [x] Chart rendering
- [x] ML predictions
- [x] Backtesting
- [x] Portfolio management

### Improvements
1. Migrated 12 components to TanStack Query
2. Added Zod validation to 8 API routes
3. Resolved 15 TypeScript errors
4. Fixed 49 failing tests
5. Updated 3 outdated dependencies

---

## ğŸ“ Documentation

### Updated Files
- [x] `.env.example` - Added new environment variables
- [x] `CHANGELOG.md` - Documented breaking changes
- [x] `README.md` - Updated setup instructions
- [x] `docs/ARCHITECTURE.md` - Added TanStack Query patterns

---

## ğŸš€ Next Steps

1. Monitor production metrics for 24 hours
2. Gather user feedback
3. Plan next modernization phase (Zustand â†’ TanStack Query mutations)

---

## ğŸ”— Related PRs

- #988: Data Quality Panel Refactor
- #1000: Core Service Stabilization
- #1012: Project Stabilizer Skill Enhancement

---

**Conclusion:** Project stabilization completed successfully. All quality gates passed. Ready for production deployment.
```

---

### æˆåŠŸå¾Œã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ (Post-Success Actions)

ã™ã¹ã¦ã®åŸºæº–ã‚’æº€ãŸã—ãŸã‚‰:

1. **ãƒãƒ¼ã‚¸ã—ã¦ main ã«ãƒ‡ãƒ—ãƒ­ã‚¤**
```bash
git checkout main
git merge --no-ff feature/stabilization
git push origin main
```

2. **ãƒªãƒªãƒ¼ã‚¹ã‚¿ã‚°ã‚’ä½œæˆ**
```bash
git tag -a v1.2.0 -m "Release v1.2.0: Project Stabilization Complete"
git push origin v1.2.0
```

3. **ãƒãƒ¼ãƒ ã«é€šçŸ¥**
```markdown
## ğŸ‰ Project Stabilization Complete!

**Summary:**
- âœ… 0 TypeScript errors
- âœ… 0 ESLint warnings
- âœ… 82.5% test coverage
- âœ… All CI checks passing

**Key Improvements:**
- Migrated 12 components to TanStack Query
- Added runtime validation with Zod
- Fixed 49 failing tests
- Improved build time by 13%

**Documentation:**
All docs updated and ready for team review.

cc: @team
```

4. **æ¬¡ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¨ˆç”»**
- ãƒãƒ¼ã‚¸å¾Œã®ç›£è¦–æœŸé–“ã‚’è¨­å®šï¼ˆ24-48æ™‚é–“ï¼‰
- æ¬¡ã®ãƒ¢ãƒ€ãƒ³åŒ–å¯¾è±¡ã‚’ç‰¹å®š
- æŠ€è¡“çš„è² å‚µã®å„ªå…ˆé †ä½ä»˜ã‘
