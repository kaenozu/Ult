# 需給の壁マスター (Supply & Demand Master)

このスキルは、市場の需給（どこで誰が買いたい/売りたいか）を視覚化し、その論理的な正しさを永続的に保証するためのものです。

## 1. 需給の壁（ボリュームプロファイル）の定義
*   **高精度な計算**: `analysis.ts` において、ビンの数を20以上に保ち、1日の出来高を `Low` から `High` の範囲に適切に分散させる。
*   **動的な閾値**: 単なる出来高の多い場所ではなく、相対的な強度（`strength > 0.4`）に基づき、意味のある壁を抽出する。

## 2. 視覚化の要件 (`StockChart.tsx`)
*   **支持と抵抗の動的判別**:
    *   価格 > 現在値：**抵抗帯（赤 / Resistance）**
    *   価格 < 現在値：**支持帯（緑 / Support）**
*   **強度の視覚化**: `strength` に比例して、線の太さ（`borderWidth`）と不透明度（`opacity`）を動的に変化させる。
*   **デグレード防止**: 他のチャート機能（SMA, BollingerBands）を追加・修正する際に、需給の壁の描画コードを誤って削除しないこと。

## 3. 品質保証（モンキーテスト）
*   **堅牢性維持**: `monkey.test.ts` を唯一の正解とし、フラッシュクラッシュや出来高ゼロ、巨大な窓開けデータでも計算が破綻しないことを常に確認する。
*   **TDDの徹底**: 計算ロジックに変更を加える際は、まず `analysis.test.ts` で期待値を定義してから実装すること。

## 4. 自動実行コマンド
*   ロジック検証: `npx jest app/lib/analysis.test.ts`
*   ストレス検証: `npx jest app/__tests__/monkey.test.ts`
