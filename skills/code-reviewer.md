# Code Reviewer Skill

## 1. 包括的なレビュー (Comprehensive Review)
ユーザーから「全ソースレビューして」「コードレビューして」といった要求があった場合、即座に包括的なレビューを実行する。

### 実行手順
1. **Exploreエージェントを起動**: `Task` ツールで `subagent_type=Explore` のエージェントを使用
2. **分析範囲**:
   - プロジェクト構造とアーキテクチャ
   - 主要コンポーネント（React/Vue等）
   - APIルートとエンドポイント
   - データ層と状態管理
   - テストカバレッジ
   - 設定ファイルと依存関係

3. **出力形式**:
   ```
   ## 📊 コードベース全体レビュー

   ### ✅ 強み
   - [良く実装されている機能のリスト]

   ### ⚠️ 重要な問題
   - **[カテゴリ]**: [ファイル]:[行番号] - [問題の説明]

   ### 🔧 推奨される改善策
   1. [具体的な改善提案]
   ```

## 2. セキュリティスキャン (Security Scan)
自動的に以下のセキュリティ問題を検出する：

- **APIエンドポイント**: レート制限、認証、認可の欠如
- **入力検証**: SQLインジェクション、XSS、コマンドインジェクションの脆弱性
- **機密情報**: ハードコードされたAPIキー、パスワード、シークレット
- **デバッグ情報**: 本番環境に露出するエラー詳細、スタックトレース

### 検出パターン
- `/api/route.ts` → レート制限の確認
- `process.env`, `API_KEY`, `SECRET` → 機密情報の検出
- `console.log`, `console.error` → デバッグコードの検出
- `dangerouslySetInnerHTML`, `eval()` → XSSリスクの検出

## 3. パフォーマンス分析 (Performance Analysis)
コードのパフォーマンス問題を自動的に検出する：

- **重い計算**: レンダリング内での複雑な計算（O(n²)以上）
- **最適化漏れ**: `useMemo`, `useCallback`, `React.memo` の未使用
- **デバウンス/スロットル未使用**: 検索、スクロールイベント
- **メモリリーク**: `useEffect` のクリーンアップ漏れ
- **キャッシュ戦略**: APIレスポンスのキャッシュ未実装

### 検出ツール
- `Grep` でパフォーマンスに関連するパターンを検索
- 複雑な計算ロジックを特定
- 非同期処理の並列化可能性を分析

## 4. コード品質チェック (Code Quality Check)
ベストプラクティスとコード品質を評価する：

- **TypeScript**: `any` 型の使用、型安全性の欠如
- **エラー処理**: 一貫性のないエラーハンドリング
- **命名規則**: 一貫性のない変数/関数名
- **重複コード**: DRY原則の違反
- **責務分離**: 単一責任原則（SRP）の違反
- **マジックナンバー**: 定数として定義されていない数値

### 自動アクション
- コード変更後、自動で影響範囲をレビュー
- テストカバレッジの欠落を検出したら警告
- リファクタリング候補を提案

## 5. レポート作成
レビュー結果を構造化されたレポートとして出力する：

```markdown
# 📋 コードレビューレポート

## サマリー
- 全ファイル数: [数]
- 検出された問題: [数]
- 重要度別内訳: 🔴 高/[数] 🟡 中/[数] 🟢 低/[数]

## カテゴリ別問題
### セキュリティ (Security)
[問題リスト]

### パフォーマンス (Performance)
[問題リスト]

### コード品質 (Code Quality)
[問題リスト]

## 推奨アクション
1. [最優先事項]
2. [次優先事項]
```

## 6. 継続的改善 (Continuous Improvement)
- 過去のレビューで指摘した問題が再発していないか自動検閲
- 新しいコード追加時、既存のパターンと比較して一貫性を確認
- ベストプラクティスのライブラリを作成・更新
