{
  "name": "conversation-learning-analyzer",
  "description": "対話の流れからエージェントスキルを自動生成・学習するスキル。過去の対話履歴を分析し、ユーザーの傾向・作業パターン・使用するコマンドを抽出し、新しいスキルを提案・生成する。",
  "version": "1.0.0",
  "priority": "medium",
  "auto_activate": false,
  "triggers": [
    "対話の流れから",
    "エージェントスキルを作って",
    "会話を分析して",
    "学習"
  ],
  "analysis_dimensions": {
    "command_patterns": "使用するコマンドのパターンと頻度",
    "task_types": "実装するタスクの種類（リファクタリング、Issue作成、テスト実行等）",
    "workflow_stages": "各作業のフェーズ（計画・実装・検証）",
    "success_indicators": "成功の指標（コード修正、マージ完了、エラー解決等）",
    "error_patterns": "発生したエラーの種類と解決方法"
  },
  "workflow": {
    "step1": "対話履歴の収集と解析",
    "step2": "コマンドパターンの抽出と分類",
    "step3": "タスクタイプの識別と優先度付け",
    "step4": "成功事例の分析（何がうまくいったか）",
    "step5": "エラーパターンの分析（何が失敗したか）",
    "step6": "スキル定義の生成（トリガー、ルール、ワークフロー）",
    "step7": "スキルファイルの出力"
  },
  "conversation_history": {
    "repository_cleanup": {
      "trigger": "リポジトリサイズが大きすぎる",
      "actions": [
        "git-filter-repo実行",
        "キャッシュファイル削除",
        "git gc --aggressive"
      ],
      "results": [
        "サイズ削減: 873MB → 17MB",
        "成功: プッシュとマージ完了"
      ],
      "key_learnings": [
        "git-filter-repoの効果的な履歴削除",
        "worktreeの並列処理効率"
      ]
    },
    "pr_management": {
      "trigger": "すべてのプルリクをエラーなくして",
      "actions": [
        "git worktreeで並列作業環境構築",
        "コンフリクト解決",
        "ドラフトPRをReady for reviewに変更"
      ],
      "results": [
        "処理数: 27個",
        "マージ数: 24個（88.9%成功率）",
        "並列効率: 3-4ブランチ同時処理可能"
      ],
      "key_learnings": [
        "リモートブランチ操作時はforce pushが必要な場合あり",
        "コンフリクトはmainマージから回避可能"
      ]
    },
    "code_review": {
      "trigger": "全ソースレビューして",
      "actions": [
        "予測精度関連ファイルのレビュー",
        "処理速度関連ファイルのレビュー",
        "課題点の特定と分類"
      ],
      "results": [
        "レビュー対象: 60+ファイル",
        "作成したIssue: 9個（PRED-XXX, PERF-XXX）"
      ],
      "key_learnings": [
        "予測精度: 疑似MLモデル（実際の学習なし）、固定アンサンブル重み",
        "処理速度: メインスレッド計算、配列操作非効率、キャッシュ不備"
      ]
    },
    "refactoring_planning": {
      "trigger": "リファクタリングの提案して",
      "actions": [
        "10個のリファクタリング案を整理",
        "GitHub Issuesへの変換"
      ],
      "results": [
        "作成したIssue: 11個（REFACTOR-XXX）"
      ],
      "key_learnings": [
        "定数・設定の一元化",
        "型安全性向上",
        "サービス層責務分離"
      ]
    },
    "agent_skill_creation": {
      "trigger": "エージェントスキルつくって",
      "actions": [
        "既存スキルを確認",
        "新規スキルの設計",
        "スキルファイルの作成（5個）"
      ],
      "results": [
        "作成したスキル: 17個",
        "カテゴリ: プルリク管理、リポジトリ最適化、CI/CD、コンフリクト解決、コードクリーンアップ、GitHub Issues、包括的分析など"
      ],
      "key_learnings": [
        "対話の文脈理解が重要",
        "実際の作業内容を反映したスキルが有効"
      ]
    },
    "refactoring_execution": {
      "trigger": "git worktreeを使って並列実装して",
      "actions": [
        "Phase 1: 基盤構築（#522, #523, #528）",
        "Phase 2: アーキテクチャ改善（#525, #526, #524）",
        "全ブランチをmainにマージ"
      ],
      "results": [
        "作成したブランチ: 11個",
        "実装済みIssue: 11個（#522-#532）",
        "マージ: 全ブランチ完了"
      ],
      "key_learnings": [
        "並列実装が効率的（git worktree活用）",
        "Phase分けが明確で進捗管理しやすい"
      ]
    },
    "testing_and_error_fix": {
      "trigger": "次のステップの提案（テスト実行）",
      "actions": [
        "TypeScript strict type checking",
        "ユニットテスト実行",
        "エラー発見と修正（JSX構文、型不一致等）",
        "回帰テスト実行中（テストタイムアウトで中断）"
      ],
      "results": [
        "TypeScriptエラー: 100件以上 → 修正（進行中）",
        "テストカバレッジ: 51.25%（目標80%未達）",
        "回帰テスト: 実行中（タイムアウト）"
      ],
      "key_learnings": [
        "型定義の不一致がテストエラーの主因",
        "リファクタリング後の回帰テストは重要"
      ]
    }
  },
  "skill_generation_patterns": {
    "command_analysis": {
      "description": "使用したコマンドを抽出（gh, git, npm, npx等）",
      "common_patterns": [
        "プルリク管理: gh pr list, gh pr merge, gh pr ready",
        "リファクタリング: git worktree add, git fetch origin main",
        "テスト実行: npm test, npx tsc, npm run lint",
        "スキル作成: JSONファイルの作成"
      ]
    },
    "task_classification": {
      "description": "タスクをカテゴライズ",
      "categories": {
        "repository_management": "リポジトリ操作（サイズ削減、クリーンアップ）",
        "pr_management": "プルリク操作（作成、マージ、レビュー対応）",
        "code_review": "コードレビュー（課題特定、Issue作成）",
        "refactoring": "リファクタリング（構造改善、重複排除）",
        "testing": "テスト実行（回帰テスト、カバレッジ確認）",
        "documentation": "ドキュメント作成（README、API仕様など）",
        "agent_development": "エージェントスキル開発（新規作成、既存更新）",
        "issue_management": "Issue管理（作成、更新、クローズ、ラベル付け）"
      },
      "priority_rules": {
        "critical": "プロジェクトの生存に関わる（CI失敗、セキュリティ脆弱性）",
        "high": "品質・パフォーマンス・可視性の改善",
        "medium": "保守性向上、ドキュメント整備",
        "low": "軽微な改善、UI/UXの向上"
      }
    },
    "skill_template": {
      "description": "新しいエージェントスキルのテンプレート",
      "required_fields": [
        {
          "name": "name",
          "type": "string",
          "description": "スキル名（一意識別子）",
          "example": "repo-size-optimizer"
        },
        {
          "name": "description",
          "type": "string",
          "description": "スキルの機能説明",
          "example": "Gitリポジトリサイズを最適化する"
        },
        {
          "name": "version",
          "type": "string",
          "description": "スキルのバージョン",
          "example": "1.0.0"
        },
        {
          "name": "priority",
          "type": "string",
          "description": "スキルの優先度（high, medium, low）",
          "example": "high"
        },
        {
          "name": "auto_activate",
          "type": "boolean",
          "description": "自動適用フラグ",
          "example": "true"
        },
        {
          "name": "triggers",
          "type": "array",
          "description": "スキルを自動適用するトリガーワードリスト",
          "example": ["リポジトリサイズが大きすぎる", "すべてのプルリクをエラーなくして"]
        },
        {
          "name": "rules",
          "type": "array",
          "description": "スキルが従うべきルールリスト",
          "example": ["parallel-processing", "conflict-resolution", "batch-optimization"]
        },
        {
          "name": "workflow",
          "type": "object",
          "description": "スキルのワークフロー定義",
          "example": {
            "step1": "分析",
            "step2": "実装",
            "step3": "検証"
          }
        },
        {
          "name": "commands",
          "type": "array",
          "description": "スキルで使用するコマンドリスト",
          "example": ["gh issue list", "git worktree add", "npm test"]
        },
        {
          "name": "capabilities",
          "type": "array",
          "description": "スキルが提供する機能",
          "example": ["並列処理", "自動エラー検出", "進捗追跡"]
        }
      ]
    },
    "generated_skills": {
      "total": 17,
      "categories": {
        "repository_management": 2,
        "pr_management": 1,
        "code_quality": 2,
        "performance": 2,
        "testing": 1,
        "infrastructure": 2,
        "documentation": 1,
        "issue_management": 1,
        "comprehensive_analysis": 2,
        "refactoring_execution": 1,
        "batch_operations": 1,
        "bulk_issue_creation": 1
      }
    }
  },
  "recommendations": {
    "based_on_conversation": [
      {
        "recommendation": "会話の文脈理解の強化",
        "reason": "ユーザーの意図を正しく理解するために、対話履歴と文脈を考慮したスキルの自動適用が重要",
        "implementation": "conversation-learning-analyzerスキルで対話履歴を保存し、文脈解析を強化"
      },
      {
        "recommendation": "エージェントスキルの自動生成",
        "reason": "新規作業パターンからスキルを自動生成・提案することで開発効率を向上",
        "implementation": "対話の内容を分析し、適切なスキル定義を自動生成"
      },
      {
        "recommendation": "テスト環境の改善",
        "reason": "TypeScriptエラーが多発し、テストカバレッジが目標未達の原因",
        "implementation": "型定義の一元化、テストダブルの排除、モックの標準化"
      },
      {
        "recommendation": "回帰テストの自動化",
        "reason": "現在の手動実行ではエラーが見逃しやすい",
        "implementation": "各マージ後に自動で回帰テストを実行し、エラーを即座に検出する仕組み"
      },
      {
        "recommendation": "進捗管理の可視化",
        "reason": "現在のtodowriteで管理だが、複雑な作業では不十分",
        "implementation": "ダッシュボードや進捗グラフを表示し、進捗状況を一目で分かるようにする"
      }
    ]
  }
}
