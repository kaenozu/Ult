# Debugger Pro Skill

## 1. ブラウザ自動化 (Browser Automation)
Chrome DevTools MCPを使用してブラウザを自動操作し、画面の問題を特定・修正する。

### 前提条件
- Chrome DevTools MCPサーバーがインストールされていること
- 開発サーバーが起動していること（通常 http://localhost:3000）

### 自動アクション
ユーザーから「画面のデバッグして」「ブラウザで確認して」といった要求があった場合：

1. **ブラウザ起動**: `chrome-devtools-mcp` の `navigate_page` ツールでアプリケーションを開く
2. **スクリーンショット取得**: `take_screenshot` で現在の画面状態をキャプチャ
3. **コンソール確認**: `list_console_messages` でエラー・警告を収集
4. **問題分析**: スクリーンショットとコンソールログから問題を特定
5. **修正提案**: 問題に応じてコード修正を提案または実行

### MCPツール使用例
```javascript
// ページを開く
navigate_page("http://localhost:3000")

// スクリーンショット
take_screenshot()

// コンソールログ
list_console_messages()

// 要素をクリック
click("selector")

// 入力
fill("selector", "text")

// ネットワークリクエスト確認
list_network_requests()
```

## 2. スクリーンショット分析 (Screenshot Analysis)
スクリーンショットを取得して自動的に分析する：

### 分析項目
- **表示崩れ**: CSSの問題、レイアウト崩れ
- **エラー表示**: エラーメッセージ、例外画面
- **ローディング状態**: ローディングインジケーター、スケルトン
- **空白/欠損**: データが表示されない箇所
- **レスポンシブ**: 画面サイズ別の表示問題

### 分析フロー
1. スクリーンショットを `mcp__4_5v_mcp__analyze_image` で分析
2. 画像からUIの問題を抽出
3. 対応するソースコードを特定
4. 修正案を生成または適用

## 3. コンソールデバッグ (Console Debugging)
ブラウザのコンソールログを自動的に収集・分析する：

### 収集対象
- **エラー (Error)**: JavaScript例外、ランタイムエラー
- **警告 (Warning)**: 非推奨API、React警告
- **情報 (Info)**: 一般的なログメッセージ

### 分析手法
- エラーメッセージからスタックトレースを解析
- エラーが発生しているファイルと行番号を特定
- 関連するソースコードを `Read` ツールで確認
- 修正パッチを生成または適用

### よくある問題パターン
- **TypeError**: 未定義のプロパティアクセス
- **ReferenceError**: 宣言されていない変数
- **NetworkError**: API呼び出し失敗
- **React Warning**: キーの欠落、非推奨メソッド

## 4. ネットワーク分析 (Network Analysis)
APIリクエストとレスポンスを分析して、バックエンドの問題を特定する：

### 確認項目
- **失敗したリクエスト**: 4xx, 5xxエラー
- **遅いリクエスト**: パフォーマンスのボトルネック
- **リクエストペイロード**: 不正なデータ送信
- **レスポンス**: 期待しないデータ形式

### デバッグフロー
1. `list_network_requests()` で全リクエストを取得
2. 失敗したリクエストを `get_network_request(id)` で詳細確認
3. ステータスコード、レスポンスボディを分析
4. 対応するAPIルートを特定
5. 修正案を生成または適用

## 5. 自動デバッグシナリオ
一般的なデバッグシナリオに対して自動的に対応する：

### シナリオ1: 画面が表示されない
```javascript
1. navigate_page(url)
2. take_screenshot()
3. list_console_messages()
4. エラーがあれば特定 → ソースコード修正
5. エラーがなければ → サーバーログ確認
```

### シナリオ2: ボタンが動かない
```javascript
1. take_screenshot()
2. click(button_selector)
3. list_console_messages()
4. イベントハンドラのソースコードを確認
5. ロジックの誤りを修正
```

### シナリオ3: APIエラー
```javascript
1. list_network_requests()
2. 失敗したリクエストを特定
3. get_network_request(id) で詳細確認
4. APIルートのコードを確認
5. バリデーションまたはロジックを修正
```

### シナリオ4: 表示がおかしい
```javascript
1. take_screenshot()
2. mcp__4_5v_mcp__analyze_image で分析
3. レイアウト問題 → CSS修正
4. データ問題 → ステート/データフェッチ修正
```

## 6. 自動修正と検証
問題を特定したら、自動的に修正して検証する：

### 修正フロー
1. 問題を特定
2. 関連するソースコードを `Read`
3. `Edit` または `Write` で修正
4. 修正後、自動で検証：
   - スクリーンショット再取得
   - コンソール確認
   - テスト実行（該当あれば）
5. 問題が解決したか確認

### 再帰的改善
問題が解決するまで以下を繰り返す：
- 修正 → 検証 → 評価 → 次の修正
- 最大3回まで自動試行
- 解決しない場合はユーザーに状況報告

## 7. モンキーテスト統合
Monkey Testerスキルと連携して、ランダム操作によるバグ検出を行う：

### 統合フロー
1. モンキーテストを実行して問題を検出
2. 検出された問題をDebugger Proで詳細分析
3. 自動修正パッチを適用
4. 再テストで問題解消を確認

### 統合実行例
```javascript
// Monkey Testerで問題検出
runMonkeyTest(url)

// 検出された問題をDebugger Proで分析
analyzeIssue(issue)

// 修正パッチ適用
applyFix(patch)

// 再テスト
verifyFix()
```

## 8. レポート作成
デバッグセッションの結果をレポートとして出力：

```markdown
# 🐛 デバッグレポート

## 問題概要
- URL: [対象ページ]
- 発生した問題: [説明]

## 検出された問題
### エラー
- [エラーメッセージ]
- ファイル: [ファイルパス:行番号]

### 警告
- [警告メッセージ]

### ネットワーク問題
- [APIエンドポイント]: [ステータスコード] - [説明]

## 実施した修正
1. [修正内容] - [ファイル:行]

## 検証結果
- ✅ 問題解決済み / ⚠️ 部分解決 / ❌ 未解決
```
## 9. 根本原因の追跡 (Root Cause Tracing)
エラーが発生した場所だけでなく、その「真の原因」を特定するための戦略。

### 追跡ステップ
1. **トリガーの特定**: エラーが発生した直接的なアクション（クリック、APIレスポンス等）を確認。
2. **データの遡及**: エラーが発生した関数に渡された引数がどこから来たか、ソースを遡る。
3. **ステートの確認**: zustand等のグローバルステートが、どの時点で「期待しない状態」になったかを確認。
4. **非同期処理の検証**: Promiseの解決順序や、競合状態（Race Condition）の可能性を調査。

### デバッグ時の質問
- 「この変数は、なぜこの値になったのか？」
- 「この関数は、意図したタイミングで呼ばれているか？」
- 「環境変数や外部APIの仕様変更の影響はないか？」
